<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FracShr — Learn Trading by Playing</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<!-- Lightweight Charts -->
<script src="https://unpkg.com/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>

<style>
:root{
  --paper:#fbf7f0;
  --ink:#111214;
  --muted:#6e6b63;

  --demo-bg:#07111a;
  --demo-text:#e7f6f4;
  --up:#00c48c;
  --down:#ff4d4f;
  --accent:#ff9f43;

  --pulse: rgba(255,255,255,0.12);

  font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

/* Reset */
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--paper);color:var(--ink);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
a{color:inherit}

/* Background animated canvas */
#bgCanvas{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:0.16}

/* Container */
.container{max-width:1100px;margin:18px auto;padding:18px;position:relative;z-index:2}

/* Header */
header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border-radius:8px;background:linear-gradient(180deg,#fff8ec,#f1e7cf);border-bottom:3px solid rgba(0,0,0,0.06)}
.brand{display:flex;gap:12px;align-items:center}
.logo svg{width:64px;height:64px}
.site-title{font-family:"Bebas Neue", "Playfair Display", serif;font-size:28px;letter-spacing:1px}
.site-sub{font-size:12px;color:var(--muted)}

nav{display:flex;gap:14px;align-items:center}
nav a{padding:8px 10px;border-radius:8px;font-weight:700}

.actions{display:flex;gap:10px;align-items:center}
.btn{padding:8px 12px;border-radius:8px;border:none;font-weight:700;cursor:pointer}
.btn-primary{background:linear-gradient(90deg,var(--up),var(--accent));color:#062424}
.btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:var(--ink)}
.hamburger{display:none}

/* Hero */
.hero{display:flex;gap:22px;align-items:flex-start;flex-wrap:wrap;margin-top:18px}
.left{flex:1;min-width:280px}
.right{width:420px;max-width:42%}
.kicker{display:inline-block;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,rgba(0,196,140,0.08),rgba(255,159,67,0.06));color:var(--muted);font-weight:700;font-size:12px}
.headline{font-family:"Bebas Neue",sans-serif;font-size:40px;margin:10px 0;text-transform:uppercase}
.lede{color:var(--muted);line-height:1.7;max-width:72ch}

/* Advantages & testimonials (stacked) */
.section{margin-top:18px}
.advantage{background:white;padding:14px;border-radius:10px;border:1px solid rgba(0,0,0,0.04);box-shadow:0 8px 24px rgba(0,0,0,0.04);margin-bottom:12px}
.advantage h3{font-family:"Bebas Neue",sans-serif;text-transform:uppercase;margin:0 0 6px 0}
.advantage p{margin:0;color:var(--muted)}

/* Pricing */
.pricing{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:18px}
.tier{background:white;padding:14px;border-radius:8px;min-width:220px;border:1px solid rgba(0,0,0,0.04);text-align:center}
.tier h4{font-family:"Bebas Neue",sans-serif;margin:6px 0;text-transform:uppercase}
.price{font-size:28px;font-weight:900}

/* Demo overlay (modern trading app) */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:220;padding:12px}
.overlay.open{display:flex}
.app{width:min(460px,94vw);height:min(86vh,820px);background:var(--demo-bg);border-radius:20px;padding:0;display:flex;flex-direction:column;overflow:hidden;border:6px solid rgba(0,0,0,0.24);box-shadow:0 40px 120px rgba(0,0,0,0.7)}
.app-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;color:var(--demo-text)}
.app-title{font-family:"Bebas Neue",sans-serif;letter-spacing:1px}

.app-body{padding:12px;display:grid;grid-template-rows:auto 1fr auto;gap:12px;flex:1;overflow:hidden}
.top-chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{background:rgba(255,255,255,0.04);padding:6px 10px;border-radius:999px;color:var(--demo-text);font-weight:700}

/* Chart area (height tuned by JS) */
.chart-area{display:flex;flex-direction:column;gap:8px;overflow:hidden}
#tradeChart{width:100%;height:100%}
#tradeRSI{width:100%;height:100%}

.controls{display:flex;gap:8px;align-items:center}
.qty{width:96px;padding:10px;border-radius:8px;border:none;background:#0b1214;color:var(--demo-text);font-weight:800}
.action{flex:1;padding:12px;border-radius:10px;border:none;font-weight:900;cursor:pointer}
.btn-buy{background:linear-gradient(90deg,var(--up),#0ea07a);color:#042724}
.btn-sell{background:linear-gradient(90deg,#ff7b7b,var(--down));color:#380807}
.btn-explain{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--demo-text);padding:10px;border-radius:8px}

/* Coach area and highlights */
.coach-area{color:var(--demo-text);font-weight:800}
.highlight{position:relative;animation:float 1.4s infinite;box-shadow:0 12px 36px rgba(255,255,255,0.04)}
.highlight::after{content:'';position:absolute;top:-12px;left:50%;transform:translateX(-50%);border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:10px solid #fff;filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));}
@keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}

/* Transaction log */
.trans-log{display:flex;gap:8px;overflow:auto;padding:6px 0}

/* Bottom bar */
.app-footer{display:flex;justify-content:space-between;align-items:center;padding:12px;border-top:1px solid rgba(255,255,255,0.04);color:var(--demo-text)}

/* Modal register/explain */
.modal-bg{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:260}
.modal-bg.open{display:flex}
.modal{background:white;padding:16px;border-radius:10px;box-shadow:0 30px 90px rgba(0,0,0,0.08);width:min(520px,94vw);}

/* Celebrate card */
.celebrate{position:fixed;left:50%;top:12%;transform:translateX(-50%);display:none;padding:14px;border-radius:10px;background:white;box-shadow:0 30px 90px rgba(0,0,0,0.08);z-index:270}
.celebrate.open{display:block}

/* Typography */
h1,h2,h3{font-family:"Bebas Neue",sans-serif;text-transform:uppercase}
p{margin:0 0 12px 0;line-height:1.6}

/* Responsive tweaks */
@media (max-width:900px){
  nav{display:none}
  .hamburger{display:inline-block}
  .mobile-menu{display:block}
  .hero{flex-direction:column;align-items:center}
  .right{width:100%}
  .app{width:94vw;height:92vh;border-radius:16px}
}
</style>
</head>
<body>

<canvas id="bgCanvas" aria-hidden="true"></canvas>

<div class="site">
  <div class="container">
    <!-- Header -->
    <header>
      <div class="brand">
        <div class="logo">
          <!-- modern logo -->
          <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs><linearGradient id="lg" x1="0" x2="1"><stop offset="0" stop-color="#0fbfa7"/><stop offset="1" stop-color="#ff9f43"/></linearGradient></defs>
            <rect width="120" height="120" rx="20" fill="#efe6cf" />
            <g transform="translate(14,14)">
              <rect x="0" y="0" width="92" height="92" rx="12" fill="#efe6cf" stroke="rgba(0,0,0,0.04)"/>
              <rect x="12" y="36" width="6" height="30" rx="1.2" fill="#0fbfa7"/>
              <rect x="30" y="26" width="6" height="42" rx="1.2" fill="#ff4d4f"/>
              <rect x="48" y="18" width="6" height="50" rx="1.2" fill="url(#lg)"/>
              <circle cx="76" cy="70" r="5" fill="#ffd166"/>
            </g>
          </svg>
        </div>
        <div>
          <div class="site-title">FRACSHR</div>
          <div class="site-sub">TRADING • LEARN • COMPETE</div>
        </div>
      </div>

      <nav aria-label="Main menu">
        <a href="#features">Advantages</a>
        <a href="#pricing">Pricing</a>
        <a href="#community">Community</a>
        <a href="#demo">Demo</a>
      </nav>

      <div class="actions">
        <button id="openDemo" class="btn btn-primary">PLAY DEMO</button>
        <button class="hamburger" id="hamburger">☰</button>
      </div>
    </header>

    <!-- HERO -->
    <main>
      <section class="hero" id="features">
        <div class="left">
          <div class="kicker">ADVANTAGES</div>
          <h1 class="headline">LEARN & PRACTICE WITH VIRTUAL MONEY — RISK FREE</h1>
          <p class="lede">FracShr is a level-based trading game that teaches trading from beginner to pro. Use virtual money in a risk-free environment, follow guided tutorials, and test strategies in trade wars with the community.</p>

          <div class="section">
            <div class="advantage">
              <h3>LEVEL-BASED LEARNING</h3>
              <p>Structured levels with guided coach tips and step confirmations — learn deliberately and progress reliably.</p>
            </div>

            <div class="advantage">
              <h3>REAL-LOOKING CHARTS</h3>
              <p>Practice using candlesticks, SMA, and RSI. Coach explains why prices move as you watch simulated rallies and drops.</p>
            </div>

            <div class="advantage">
              <h3>COMMUNITY & TRADE WARS</h3>
              <p>Design challenges, broadcast them, invite friends and compete in timed profit battles.</p>
            </div>

            <div class="advantage">
              <h3>RISK-FREE</h3>
              <p>All trades use virtual money — you learn real concepts without financial risk.</p>
            </div>
          </div>
        </div>

        <aside class="right" id="demo">
          <div style="font-weight:900;margin-bottom:10px;text-align:center">DEMO PREVIEW</div>
          <div style="padding:12px;border-radius:10px;background:linear-gradient(180deg,#f0e6cf,#e7dfc1);border:1px solid rgba(0,0,0,0.04)">
            <canvas id="previewCanvas" width="320" height="160"></canvas>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
              <div style="font-weight:800">$10,000</div>
              <div style="color:var(--up);font-weight:800">+10%</div>
            </div>
            <div style="display:flex;justify-content:center;margin-top:10px">
              <button id="openFromPreview" class="btn btn-primary">OPEN DEMO</button>
            </div>
          </div>
        </aside>
      </section>

      <!-- Pricing -->
      <section id="pricing" style="margin-top:28px;text-align:center">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:24px;text-transform:uppercase;margin:0;">PRICING</h2>
        <div class="pricing" style="margin-top:12px">
          <div class="tier">
            <h4>Beginner</h4>
            <div class="price">$150</div>
            <div style="font-weight:700;margin-top:6px">Levels 1 - 50</div>
            <ul style="text-align:left;color:var(--muted);padding-left:18px;margin-top:8px">
              <li>Foundations: orders & charts</li>
              <li>Slow tutorial pace & coach tips</li>
              <li>Risk-free virtual money practice</li>
            </ul>
          </div>
          <div class="tier">
            <h4>Intermediate</h4>
            <div class="price">$350</div>
            <div style="font-weight:700;margin-top:6px">Levels 50 - 100</div>
            <ul style="text-align:left;color:var(--muted);padding-left:18px;margin-top:8px">
              <li>Indicators & simple strategies</li>
              <li>Scenario tests & timed challenges</li>
              <li>Community features</li>
            </ul>
          </div>
          <div class="tier">
            <h4>Pro</h4>
            <div class="price">$500</div>
            <div style="font-weight:700;margin-top:6px">Levels 100+</div>
            <ul style="text-align:left;color:var(--muted);padding-left:18px;margin-top:8px">
              <li>Advanced strategies & risk</li>
              <li>Trade wars, leaderboards & creator tools</li>
              <li>Community access & mentorship</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Testimonials & community (centered) -->
      <section id="community" style="margin-top:28px;text-align:center">
        <h2 style="font-family:'Bebas Neue',sans-serif;text-transform:uppercase;margin:0 0 10px 0">COMMUNITY</h2>
        <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:12px">
          <div class="advantage" style="max-width:420px"><h3>Testimonials</h3><p class="muted">"FracShr made trading approachable and fun." — Lina</p><p class="muted">"I leveled up quickly with the guided tutorials." — Tom</p></div>
          <div class="advantage" style="max-width:420px"><h3>Creators</h3><p class="muted">Design challenges and share them with learners worldwide.</p></div>
        </div>
      </section>

    </main>

    <footer style="margin-top:28px;text-align:center;color:var(--muted);">© 2025 FracShr — All rights reserved</footer>
  </div>
</div>

<!-- DEMO overlay: modern trading app -->
<div class="overlay" id="demoOverlay" aria-hidden="true">
  <div class="app" role="dialog" aria-label="FracShr trading demo">
    <div class="app-header">
      <div class="app-title">FRACSHR APP</div>
      <div>
        <button class="btn btn-ghost" id="demoReset">RESET</button>
        <button class="btn btn-ghost" id="demoClose">CLOSE</button>
      </div>
    </div>

    <div class="app-body">
      <div class="app-top">
        <div class="top-chips">
          <div class="chip">Cash: <strong id="cash">$10,000</strong></div>
          <div class="chip">Shares: <strong id="shares">0</strong></div>
          <div class="chip">Price: <strong id="price">$100.00</strong></div>
        </div>
        <div class="top-chips">
          <div class="chip">Portfolio: <strong id="portfolio">$10,000</strong></div>
          <div class="chip">Goal: <strong>$11,000</strong></div>
        </div>
      </div>

      <div class="chart-area">
        <div id="tradeChart"></div>
        <div id="tradeRSI"></div>
      </div>

      <div>
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
          <div style="font-weight:700;color:#cbd9d6">Actions</div>
          <div style="margin-left:auto;color:#99a2a1">Transactions</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="qty" class="qty" type="number" min="1" value="50" />
          <button id="buy" class="btn-action btn-buy">BUY</button>
          <button id="sell" class="btn-action btn-sell" disabled>SELL</button>
          <button id="explain" class="btn-explain">Explain</button>
        </div>
        <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
          <div style="font-size:13px;color:#99a2a1">Log:</div>
          <div id="transLog" style="flex:1;display:flex;gap:8px;overflow:auto"></div>
        </div>
      </div>
    </div>

    <div class="app-footer">
      <div id="coach">Coach: Press Next to begin</div>
      <div style="display:flex;gap:8px">
        <button id="prev" class="btn btn-ghost" disabled>Prev</button>
        <button id="next" class="btn btn-primary">Next</button>
      </div>
    </div>
  </div>
</div>

<!-- Explain modal -->
<div class="modal-bg" id="explainModal" style="display:none">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">Indicators — Quick Guide</h3>
      <button id="closeExplain2" class="btn btn-ghost">Close</button>
    </div>
    <p style="color:var(--muted);margin-top:8px">Read quickly and click "I Understand".</p>
    <div style="margin-top:8px"><strong>SMA</strong><p style="color:var(--muted)">SMA smooths recent price — useful as trend filter.</p></div>
    <div style="margin-top:8px"><strong>RSI</strong><p style="color:var(--muted)">RSI measures momentum — watch for overbought/oversold.</p></div>
    <div style="display:flex;justify-content:flex-end;margin-top:12px"><button id="understand2" class="btn btn-primary">I Understand</button></div>
  </div>
</div>

<!-- Celebrate + Register -->
<div class="celebrate" id="celebrateCard" style="display:none">
  <div style="font-size:22px;font-weight:900">⭐ ⭐ ⭐</div>
  <div style="margin-top:8px;font-weight:800">LEVEL COMPLETE</div>
  <div style="margin-top:6px;color:var(--muted)">Nice job — register for early access.</div>
  <div style="display:flex;gap:8px;justify-content:center;margin-top:10px">
    <button id="openRegister" class="btn btn-primary">Register</button>
    <button id="closeCelebrate" class="btn btn-ghost">Close</button>
  </div>
</div>

<div class="modal-bg" id="registerModal" style="display:none">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">REGISTER INTEREST</h3>
      <button id="closeRegisterBtn" class="btn btn-ghost">Close</button>
    </div>
    <p style="color:var(--muted);margin-top:8px">Enter details and we'll notify you at launch.</p>
    <input id="rname" placeholder="Full name" style="width:100%;padding:8px;margin-top:8px;border-radius:6px;border:1px solid rgba(0,0,0,0.06)"/>
    <input id="remail" placeholder="Email" style="width:100%;padding:8px;margin-top:8px;border-radius:6px;border:1px solid rgba(0,0,0,0.06)"/>
    <div style="display:flex;gap:8px;margin-top:8px"><label><input id="rios" type="checkbox"/> iOS</label><label><input id="randroid" type="checkbox"/> Android</label><label><input id="rcreator" type="checkbox"/> Creator</label></div>
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
      <button id="submitRegister" class="btn btn-primary">Notify Me</button>
    </div>
    <div id="registerMsg" style="margin-top:8px;color:#534b41"></div>
  </div>
</div>

<script>
/* Basic helpers */
const $ = id => document.getElementById(id);
const sleep = ms => new Promise(r=>setTimeout(r, ms));
const fmt = v => '$' + Number(v).toLocaleString(undefined,{maximumFractionDigits:2});

/* Floating candlesticks background */
(function(){
  const canvas = $('bgCanvas'), ctx = canvas.getContext('2d'), dpr = Math.max(1, window.devicePixelRatio || 1);
  function resize(){ canvas.width = innerWidth * dpr; canvas.height = innerHeight * dpr; canvas.style.width = innerWidth + 'px'; canvas.style.height = innerHeight + 'px'; ctx.setTransform(dpr,0,0,dpr,0,0); }
  resize(); window.addEventListener('resize', resize);
  const list=[];
  function spawn(){ list.push({ x: innerWidth + 60, y: 30 + Math.random()*(innerHeight - 70), w:6+Math.random()*10, h:12+Math.random()*80, c: Math.random()>0.45 ? '#00c48c' : '#ff4d4f', s:0.6 + Math.random()*1.6, op:1 - Math.random()*0.4 }); if(list.length>150) list.splice(0,10); }
  function draw(){
    ctx.clearRect(0,0,innerWidth,innerHeight);
    if(Math.random() < 0.12) spawn();
    for(let i=list.length-1;i>=0;i--){
      const p = list[i]; p.x -= p.s; p.op = Math.max(0, p.op - 0.002);
      ctx.globalAlpha = 0.16 * (p.op + 0.25);
      ctx.fillStyle = p.c; ctx.fillRect(p.x, p.y - p.h*0.3, p.w, p.h*0.5);
      ctx.globalAlpha = 0.06 * (p.op + 0.5); ctx.fillRect(p.x-8, p.y-18, p.w+16, p.h+36);
    }
    ctx.globalAlpha = 1;
    requestAnimationFrame(draw);
  }
  draw();
})();

/* Preview sparkline */
(function(){
  const c = $('previewCanvas'), ctx = c.getContext('2d');
  let arr=[], b=100; for(let i=0;i<60;i++){ b += (Math.random()-0.5)*1.2; arr.push(b); }
  function draw(){ ctx.clearRect(0,0,c.width,c.height); ctx.fillStyle='rgba(0,0,0,0.03)'; ctx.fillRect(0,0,c.width,c.height); ctx.beginPath(); const min=Math.min(...arr), max=Math.max(...arr), range=max-min||1; for(let i=0;i<arr.length;i++){ const x=(i/(arr.length-1))*c.width; const y=c.height - ((arr[i]-min)/range)*(c.height-18)-9; if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); } ctx.strokeStyle='#1b1613'; ctx.lineWidth=2; ctx.stroke(); if(Math.random()<0.22){ arr.push(arr[arr.length-1] + (Math.random()-0.45)*1.1); if(arr.length>80) arr.shift(); } requestAnimationFrame(draw); } draw();
})();

/* Mobile menu */
(function(){ const hb = $('hamburger'), mm = $('mobileMenu'); hb.addEventListener('click', ()=> mm.style.display = mm.style.display === 'block' ? 'none' : 'block'); document.querySelectorAll('.mobile-menu a').forEach(a=>a.addEventListener('click', ()=> mm.style.display='none')); })();

/* DEMO app logic */
(function(){
  // Elements
  const openBtns = [ $('openDemo'), $('openFromPreview'), $('playDemoHero'), $('mobilePlay') ].filter(Boolean);
  const overlay = $('demoOverlay'), btnClose = $('demoClose'), btnReset = $('demoReset');
  const coachEl = $('coach'), stepEl = $('stepNum');
  const btnBuy = $('buy'), btnSell = $('sell'), qty = $('qty');
  const btnExplain = $('explain'), explainModal = $('explainModal'), explainClose = $('closeExplain2'), btnUnderstand = $('understand2');
  const chartDiv = $('tradeChart'), rsiDiv = $('tradeRSI'), txLog = $('transLog');
  const cashEl = $('cash'), sharesEl = $('shares'), priceEl = $('price'), portEl = $('portfolio'), unrealEl = $('unrealized'), realEl = $('realized'), progress = $('goalProgress');
  const nextBtn = $('next'), prevBtn = $('prev');
  const celebrateCard = $('celebrateCard'), openReg = $('openRegister'), closeCelebrate = $('closeCelebrate');
  const registerModal = $('registerModal'), registerClose = $('closeRegisterBtn'), registerSubmit = $('submitRegister'), registerMessage = $('registerMessage');
  const confCanvas = $('confetti');

  // State variables
  const INITIAL = 10000, GOAL = 11000;
  let cash = INITIAL, shares = 0, avgPrice = 0, realized = 0, currentPrice = 100;
  let candles = [], txs = [];
  let step = 0, explained = false, animating = false;
  let chart=null, candleSeries=null, smaSeries=null, rsiChart=null, rsiSeries=null, ro=null;

  // Wire openers
  openBtns.forEach(b => b.addEventListener('click', openDemo));
  btnClose.addEventListener('click', closeDemo);
  btnReset.addEventListener('click', ()=> initDemo(true));

  // Explain modal wiring
  btnExplain.addEventListener('click', ()=> { explainModal.style.display = 'flex'; highlightElement(btnExplain); nextBtn.disabled = true; });
  explainClose.addEventListener('click', ()=> { explainModal.style.display = 'none'; unhighlightAll(); });
  btnUnderstand.addEventListener('click', ()=> { explained = true; explainModal.style.display = 'none'; unhighlightAll(); narrate('Understood — proceed when ready.'); if(step===1) nextBtn.disabled=false; });

  // Register modal
  openReg.addEventListener('click', ()=> { registerModal.style.display='flex' });
  closeCelebrate.addEventListener('click', ()=> celebrateCard.classList.remove('open'));
  registerClose.addEventListener('click', ()=> registerModal.style.display='none');
  registerSubmit.addEventListener('click', ()=> {
    const n = $('rname').value.trim(), e = $('remail').value.trim();
    if(!n || !e){ registerMessage.textContent = 'Name & email required'; return; }
    const list = JSON.parse(localStorage.getItem('fracshr_reg')||'[]'); list.unshift({ name:n, email:e, ios:$('rios').checked, android:$('randroid').checked, creator:$('rcreator').checked, ts:Date.now() }); localStorage.setItem('fracshr_reg', JSON.stringify(list));
    registerMessage.textContent = 'Thanks — we will notify you!';
    setTimeout(()=> { registerModal.style.display='none'; registerMessage.textContent=''; $('rname').value=''; $('remail').value=''; },1200);
  });

  // Initialize demo (not open)
  initDemo(true);

  function openDemo(){ overlay.classList.add('open'); document.body.style.overflow='hidden'; initDemo(false); }
  function closeDemo(){ overlay.classList.remove('open'); document.body.style.overflow=''; destroyCharts(); unhighlightAll(); }

  function initDemo(skipOpen=false){
    cash = INITIAL; shares = 0; avgPrice = 0; realized = 0; currentPrice = 100;
    step = 0; explained = false; animating = false;
    qty.value = 50; btnBuy.disabled = true; btnSell.disabled = true; nextBtn.disabled=false; prevBtn.disabled=true;
    stepEl.textContent = '1';
    txLog.innerHTML = '<div style="color:#cdb88e">— no transactions —</div>';
    narrate('Welcome — press Next to begin the guided tutorial.');
    candles = generateCandles(120, 100);
    buildCharts();
    updateDisplay();
    if(!skipOpen) overlay.classList.add('open');
  }

  function generateCandles(n=120,start=100){
    const arr=[]; let last=start;
    for(let i=n-1;i>=0;i--){ const time = Math.floor((Date.now() - i*60*1000)/1000); const open = last; const rnd = (Math.random()-0.5)*0.01; const close = Math.max(0.1, open*(1+rnd)); const high = Math.max(open,close)*(1+Math.random()*0.002); const low = Math.min(open,close)*(1-Math.random()*0.002); arr.push({ time, open:+open.toFixed(4), high:+high.toFixed(4), low:+low.toFixed(4), close:+close.toFixed(4) }); last = close; }
    return arr;
  }

  function buildCharts(){
    destroyCharts();
    chartDiv.innerHTML=''; rsiDiv.innerHTML='';
    const frame = document.querySelector('.app');
    const headerH = document.querySelector('.app-header').offsetHeight;
    const topH = document.querySelector('.app-top').offsetHeight;
    const footerH = document.querySelector('.app-footer').offsetHeight;
    const totalH = frame.clientHeight;
    const avail = totalH - (headerH + topH + footerH + 160);
    const chartH = Math.max(160, Math.round(avail * 0.72));
    const rsiH = Math.max(64, Math.round(avail - chartH - 6));
    chartDiv.style.height = chartH + 'px'; rsiDiv.style.height = rsiH + 'px';

    chart = LightweightCharts.createChart(chartDiv, { width: chartDiv.clientWidth, height: chartH, layout:{ backgroundColor:'#07111a', textColor:'#e7f6f4' }, rightPriceScale:{ borderVisible:false }, timeScale:{ borderVisible:false }});
    candleSeries = chart.addCandlestickSeries({
      upColor: getComputedStyle(document.documentElement).getPropertyValue('--up').trim() || '#00c48c',
      borderUpColor: getComputedStyle(document.documentElement).getPropertyValue('--up').trim() || '#00c48c',
      wickUpColor: getComputedStyle(document.documentElement).getPropertyValue('--up').trim() || '#00c48c',
      downColor: getComputedStyle(document.documentElement).getPropertyValue('--down').trim() || '#ff4d4f',
      borderDownColor: getComputedStyle(document.documentElement).getPropertyValue('--down').trim() || '#ff4d4f',
      wickDownColor: getComputedStyle(document.documentElement).getPropertyValue('--down').trim() || '#ff4d4f'
    });
    smaSeries = chart.addLineSeries({ color:'#d4c59b', lineWidth:2 });
    candleSeries.setData(candles.map(c=>({ time:c.time, open:c.open, high:c.high, low:c.low, close:c.close })));
    smaSeries.setData(calcSMA(candles,20));

    rsiChart = LightweightCharts.createChart(rsiDiv, { width: rsiDiv.clientWidth, height: rsiH, layout:{ backgroundColor:'#07111a', textColor:'#e7f6f4' }, rightPriceScale:{ visible:true }, timeScale:{ visible:true }});
    rsiSeries = rsiChart.addLineSeries({ color:'#cfa47a', lineWidth:2 });
    rsiSeries.setData(calcRSI(candles,14));
    chart.timeScale().fitContent();

    if(window.ResizeObserver){
      ro = new ResizeObserver(entries => { for(const e of entries){ try{ chart.applyOptions({ width: Math.floor(e.contentRect.width) }); rsiChart.applyOptions({ width: Math.floor(e.contentRect.width) }); }catch(e){} }});
      ro.observe(chartDiv);
    } else {
      window.addEventListener('resize', ()=> { try{ chart.applyOptions({ width: chartDiv.clientWidth }); rsiChart.applyOptions({ width: rsiDiv.clientWidth }); }catch(e){} });
    }
  }

  function destroyCharts(){ try{ chart && chart.remove(); rsiChart && rsiChart.remove(); }catch(e){} if(ro){ try{ ro.disconnect(); }catch(e){} ro=null; } chart=candleSeries=smaSeries=rsiChart=rsiSeries=null; }

  function calcSMA(arr,p){ const out=[]; let s=0; for(let i=0;i<arr.length;i++){ s += arr[i].close; if(i>=p) s -= arr[i-p].close; if(i>=p-1) out.push({ time: arr[i].time, value: +(s/p).toFixed(6) }); } return out; }
  function calcRSI(arr,p){ const out=[]; if(arr.length < p+1) return out; let g=0,l=0; for(let i=1;i<=p;i++){ const d=arr[i].close - arr[i-1].close; if(d>0) g+=d; else l+=Math.abs(d); } let ag=g/p, al=l/p; let rs = al===0?100:ag/al; let rsi = al===0?100:100-(100/(1+rs)); out.push({ time: arr[p].time, value: +rsi.toFixed(4) }); for(let i=p+1;i<arr.length;i++){ const d=arr[i].close - arr[i-1].close; const gain=Math.max(d,0), loss=Math.max(-d,0); ag = ((ag*(p-1))+gain)/p; al = ((al*(p-1))+loss)/p; rs = al===0?100:ag/al; rsi = al===0?100:100-(100/(1+rs)); out.push({ time: arr[i].time, value: +rsi.toFixed(4) }); } return out; }

  // UI updates
  function updateDisplay(){ cashEl.textContent = fmt(cash); sharesEl.textContent = shares; priceEl.textContent = '$' + currentPrice.toFixed(2); portEl.textContent = fmt(cash + shares * currentPrice); unrealEl.textContent = fmt(shares * (currentPrice - avgPrice)); realEl.textContent = fmt(realized); const pct = Math.min(100, Math.round(((cash + shares * currentPrice)/GOAL)*100)); progress.style.width = pct + '%'; }

  function narrate(txt){ coachEl.textContent = txt; }

  // highlight element
  function highlightElement(el){ unhighlightAll(); if(!el) return; el.classList.add('highlight'); try{ el.scrollIntoView({behavior:'smooth',block:'center'}); }catch(e){} }
  function unhighlightAll(){ document.querySelectorAll('.highlight').forEach(x=>x.classList.remove('highlight')); }

  // Actions: buy/sell/next
  btnBuy.addEventListener('click', ()=> {
    if(animating) return;
    const q = Math.max(1, parseInt(qty.value||'0',10));
    const cost = q * currentPrice;
    if(cost > cash){ narrate('Insufficient cash — lower quantity.'); return; }
    avgPrice = ((avgPrice * shares) + currentPrice * q) / (shares + q || 1);
    shares += q; cash -= cost;
    logTrans(`BUY ${q} @ ${fmt(currentPrice)}`);
    narrate(`Bought ${q} shares @ ${fmt(currentPrice)} — press Next.`);
    btnBuy.disabled = true; btnSell.disabled = false; nextBtn.disabled = false; prevBtn.disabled = false;
    updateDisplay(); unhighlightAll();
  });

  btnSell.addEventListener('click', ()=> {
    if(animating) return;
    if(shares <= 0){ narrate('No shares to sell.'); return; }
    const q = shares; const proceeds = q * currentPrice; const profit = proceeds - (avgPrice * q);
    realized += profit; cash += proceeds;
    logTrans(`SELL ${q} @ ${fmt(currentPrice)} (P/L ${fmt(profit)})`);
    shares = 0; avgPrice = 0;
    narrate(`Sold ${q} shares. Realized ${fmt(profit)} — press Next.`);
    btnSell.disabled = true; btnBuy.disabled = true; nextBtn.disabled = false;
    updateDisplay(); unhighlightAll();
  });

  nextBtn.addEventListener('click', async ()=>{
    if(animating) return;
    if(step === 0){
      step = 1; stepEl.textContent = '2';
      narrate('Step 2 — review indicators: click Explain then "I Understand".');
      highlightElement(btnExplain); nextBtn.disabled = true; prevBtn.disabled = false;
      explainModal.style.display = 'flex';
      return;
    }
    if(step === 1){
      if(!explained){ narrate('Please confirm understanding first.'); nextBtn.disabled = true; return; }
      step = 2; stepEl.textContent = '3';
      narrate('Step 3 — execute the recommended BUY (qty 50).');
      btnBuy.disabled = false; highlightElement(btnBuy); nextBtn.disabled = true;
      return;
    }
    if(step === 2){
      if(shares <= 0){ narrate('Please BUY to proceed.'); nextBtn.disabled = true; return; }
      step = 3; stepEl.textContent = '4';
      narrate('Step 4 — click Next to animate a calm rally; I will narrate reasons.');
      nextBtn.disabled = false; unhighlightAll();
      return;
    }
    if(step === 3){
      step = 4; stepEl.textContent = '5';
      narrate('Animating rally now...');
      nextBtn.disabled = true;
      await animateNarratedRally(currentPrice * 1.22, 14, 520);
      narrate('Rally ended — SELL to lock profit (button highlighted).');
      btnSell.disabled = false; highlightElement(btnSell);
      return;
    }
    if(step === 4){
      if(shares > 0){ narrate('Please SELL to finalize.'); nextBtn.disabled = true; return; }
      narrate('Finalizing...');
      await sleep(700);
      if(cash >= GOAL){ await celebrateSequence(); } else { narrate('Goal not reached — try again.'); nextBtn.disabled = true; }
    }
  });

  prevBtn.addEventListener('click', ()=> initDemo(true));

  async function animateNarratedRally(target, steps=14, delay=520){
    animating = true;
    let last = candles[candles.length-1].close;
    for(let i=1;i<=steps;i++){
      const t = i/steps; const ease = t<0.5 ? 2*t*t : -1 + (4-2*t)*t;
      let next = last + (target - last) * ease; next *= 1 + (Math.random()-0.5)*0.004;
      const open = candles[candles.length-1].close; const high = Math.max(open,next)*(1+Math.random()*0.003); const low = Math.min(open,next)*(1-Math.random()*0.003);
      const time = Math.floor(Date.now()/1000) + i*60;
      const c = { time, open:+open.toFixed(4), high:+high.toFixed(4), low:+low.toFixed(4), close:+next.toFixed(4) };
      candles.push(c);
      try{ candleSeries.update({ time:c.time, open:c.open, high:c.high, low:c.low, close:c.close }); smaSeries.setData(calcSMA(candles,20)); rsiSeries.setData(calcRSI(candles,14)); }catch(e){}
      // Narration logic
      const smaArr = calcSMA(candles,20); const smaVal = smaArr.length ? smaArr[smaArr.length-1].value : null;
      const rsiArr = calcRSI(candles,14); const rsiVal = rsiArr.length ? rsiArr[rsiArr.length-1].value : null;
      const pct = (next - last)/last * 100;
      let reason = '';
      if(pct > 0.15){ reason = 'Momentum: price rising'; if(smaVal && next > smaVal) reason += ' (above SMA20)'; if(rsiVal && rsiVal > 65) reason += '; RSI strong'; }
      else if(pct < -0.15){ reason = 'Selling pressure: price falling'; if(smaVal && next < smaVal) reason += ' (below SMA20)'; if(rsiVal && rsiVal < 35) reason += '; RSI weak'; }
      else reason = 'Small move — consolidation';
      narrate(reason);
      last = next; currentPrice = next; updateDisplay();
      await sleep(delay);
    }
    animating = false;
  }

  // Highlight helper functions
  function highlightElement(el){ unhighlightAll(); if(!el) return; el.classList.add('highlight'); try{ el.scrollIntoView({behavior:'smooth',block:'center'}) }catch(e){} }
  function unhighlightAll(){ document.querySelectorAll('.highlight').forEach(x=>x.classList.remove('highlight')); }

  // Transaction log helper
  function logTrans(note){ const el=document.createElement('div'); el.style.padding='6px 8px'; el.style.borderRadius='8px'; el.style.background='rgba(255,255,255,0.03)'; el.style.fontSize='12px'; el.innerHTML = `<div style="font-weight:700">${note}</div><div style="font-size:11px;color:#cdb88e">${new Date().toLocaleTimeString()}</div>`; txLog.prepend(el); while(txLog.children.length>8) txLog.removeChild(txLog.lastChild); }

  // Confetti and celebrate
  async function celebrateSequence(){
    $('confetti').style.display = 'block';
    await runConfetti(4500);
    celebrateCard.classList.add('open'); celebrateCard.style.display='block';
    setTimeout(()=> { $('registerModal').style.display='flex'; }, 1200);
    setTimeout(()=> { celebrateCard.classList.remove('open'); $('confetti').style.display='none'; }, 3200);
  }

  function runConfetti(duration=4500){
    return new Promise(resolve=>{
      const canvas = $('confetti'), ctx = canvas.getContext('2d'), dpr = Math.max(1, window.devicePixelRatio || 1);
      function resize(){ canvas.width = innerWidth * dpr; canvas.height = innerHeight * dpr; canvas.style.width = innerWidth+'px'; canvas.style.height = innerHeight+'px'; ctx.setTransform(dpr,0,0,dpr,0,0); }
      resize(); window.addEventListener('resize', resize);
      const colors = [getComputedStyle(document.documentElement).getPropertyValue('--up').trim()||'#00c48c', getComputedStyle(document.documentElement).getPropertyValue('--down').trim()||'#ff4d4f', '#ffd166', '#00a3ff'];
      const parts = [];
      for(let i=0;i<160;i++){ parts.push({ x: innerWidth*0.5 + (Math.random()-0.5)*300, y: innerHeight*0.28 + (Math.random()-0.5)*120, vx:(Math.random()-0.5)*6, vy:Math.random()*3 + 2, size:6 + Math.random()*8, rot:Math.random()*Math.PI*2, vrot:(Math.random()-0.5)*0.3, color:colors[Math.floor(Math.random()*colors.length)], life:0, ttl:80 + Math.random()*100 }); }
      let raf;
      function frame(){ ctx.clearRect(0,0,innerWidth,innerHeight); for(let i=parts.length-1;i>=0;i--){ const p = parts[i]; p.x += p.vx; p.y += p.vy; p.vy += 0.12; p.rot += p.vrot; p.life++; const a = 1 - p.life/p.ttl; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.globalAlpha = Math.max(0,a); ctx.fillStyle = p.color; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6); ctx.restore(); if(p.y > innerHeight + 80 || p.life > p.ttl) parts.splice(i,1); } if(parts.length>0) raf = requestAnimationFrame(frame); else { canvas.style.display='none'; window.removeEventListener('resize', resize); resolve(); } } raf = requestAnimationFrame(frame);
    });
  }

  // Utility functions
  function fmt(v){ return '$' + Number(v).toLocaleString(); }

})();
</script>

</body>
</html>
