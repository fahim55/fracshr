<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FracShr — Trading For Everyone, Anywhere, Everywhere</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="FracShr is a level-based trading game. Learn trading with interactive tutorials, pro charts, goal-based levels, and Trading Wars. iOS & Android coming soon." />
  <meta name="theme-color" content="#0a0d12" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Poppins:wght@800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0a0d12; --bg2:#0c121a;
      --panel:#0f1624; --card:#0f1726; --line:#152640;
      --text:#ecf5ff; --muted:#96a8c0;
      --accent1:#2DE2E6; --accent2:#8A2BE2; --accent3:#FF4D8D; --accent4:#00FFA3; --accent5:#FFC857;
      --up:#20e3b2; --down:#ff6b88;
      --shadow: 0 18px 60px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.06);
      --vh: 1vh;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;scroll-behavior:smooth;background:var(--bg);color:var(--text)}
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      line-height:1.55;
      background:
        radial-gradient(900px 600px at -10% -20%, #1b2b8a22 0%, transparent 60%),
        radial-gradient(900px 600px at 110% 120%, #2de2e622 0%, transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
      overflow-x:hidden;
    }
    .no-scroll{overflow:hidden}

    /* Background visuals */
    .bg-candles{position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.35;mask-image:radial-gradient(ellipse at center,#000 60%,transparent 100%)}
    .candle{
      position:absolute;width:8px;height:24px;border-radius:2px;
      background:linear-gradient(180deg,var(--accent1),var(--accent3));
      box-shadow:0 0 18px rgba(45,226,230,.35);
      opacity:.28;transform:translateY(110vh) scale(.9);
      animation:rise linear forwards;
    }
    .candle::before,.candle::after{content:"";position:absolute;left:50%;transform:translateX(-50%);width:2px;background:rgba(255,255,255,.7);border-radius:1px}
    .candle::before{top:-16px;height:16px}.candle::after{bottom:-16px;height:16px}
    @keyframes rise{0%{transform:translateY(110vh) scale(.9)}100%{transform:translateY(-20vh) scale(1);opacity:0}}

    /* Header / Nav */
    header{position:sticky;top:0;z-index:40;background:rgba(10,14,26,.7);backdrop-filter:saturate(120%) blur(10px);border-bottom:1px solid rgba(255,255,255,.08)}
    .nav{max-width:1200px;margin:0 auto;padding:10px 18px;display:flex;justify-content:center;align-items:center;gap:14px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--text)}

    .logo{
      width:56px;height:56px;border-radius:14px;display:grid;place-items:center;
      background:radial-gradient(100% 100% at 30% 30%, #1b2333 0%, #0f1624 60%, #0c121a 100%);
      box-shadow:0 10px 26px rgba(45,226,230,.18), 0 0 0 3px rgba(255,255,255,.06) inset;
      position:relative;overflow:hidden;
    }
    .logo .halo{position:absolute;inset:-30%;background:conic-gradient(from 0deg,var(--accent1),var(--accent2),var(--accent3),var(--accent1));filter:blur(24px);opacity:.18;animation:spin 18s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .wordmark{
      font-family:Poppins,sans-serif;font-weight:900;letter-spacing:.6px;font-size:1.5rem;
      background:linear-gradient(90deg,#fff,#b7f7ff 60%,#fff);-webkit-background-clip:text;background-clip:text;color:transparent;
      display:inline-block;
    }

    .menu-btn{
      display:none;min-width:44px;min-height:44px;line-height:1;background:transparent;
      border:2px solid rgba(255,255,255,.18);color:var(--text);border-radius:12px;padding:8px 12px;font-weight:800;font-size:20px
    }

    .nav-links{display:flex;gap:14px;align-items:center;flex-wrap:wrap;justify-content:center}
    .nav-links a{color:var(--muted);text-decoration:none;font-weight:700}
    .nav-links a:hover{color:var(--text)}
    .btn{appearance:none;border:none;outline:none;cursor:pointer;padding:12px 18px;border-radius:14px;font-weight:800;letter-spacing:.2px;color:#06111a;background:linear-gradient(90deg,var(--accent1),var(--accent2));box-shadow:0 10px 20px rgba(138,43,226,.22),0 4px 14px rgba(45,226,230,.22)}
    .btn:hover{transform:translateY(-1px)}
    .btn-outline{background:transparent;color:var(--text);border:2px solid rgba(255,255,255,.16);box-shadow:none}
    .btn-outline:hover{border-color:rgba(255,255,255,.35)}
    .cta-pulse{position:relative}
    .cta-pulse::after{content:"";position:absolute;inset:-8px;border-radius:18px;border:2px solid rgba(45,226,230,.25);animation:pulse 2.2s infinite ease-out}
    @keyframes pulse{0%{transform:scale(1);opacity:.9}70%{transform:scale(1.12);opacity:0}100%{transform:scale(1.12);opacity:0}}

    @media (max-width:760px){
      .nav{justify-content:space-between}
      .menu-btn{display:block}
      .nav-links{
        position:fixed;left:0;right:0;top:calc(env(safe-area-inset-top,0) + 56px);
        background:linear-gradient(180deg,#101a33,#0b1426);
        border-top:1px solid rgba(255,255,255,.08);
        display:block;transform:translateY(-8px);opacity:0;pointer-events:none;
        max-height:70vh;overflow:auto;padding:12px;
        transition:transform .25s ease, opacity .25s ease;
        z-index:55;
      }
      .nav-links.open{transform:translateY(0);opacity:1;pointer-events:auto}
      .nav-links a, .nav-links .btn, .nav-links .btn-outline{
        display:block;width:100%;text-align:center;margin:6px 0;font-size:clamp(1rem, 4.2vw, 1.1rem);padding:14px 16px;border-radius:14px
      }
      body.menu-open{overflow:hidden}
    }

    /* Hero */
    .hero{position:relative;z-index:1;max-width:1200px;margin:0 auto;padding:60px 18px 20px;display:grid;gap:22px;justify-items:center;text-align:center}
    .tagline{display:inline-block;padding:8px 14px;border-radius:999px;font-weight:900;font-size:.8rem;color:#07131a;background:linear-gradient(90deg,var(--accent4),var(--accent1));box-shadow:var(--shadow)}
    h1.big{font-family:Poppins,sans-serif;font-weight:900;line-height:1.06;margin:16px 0 10px;font-size:clamp(2rem,4.2vw,3.6rem);background:linear-gradient(90deg,#fff,#b7f7ff 60%,#fff);-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 10px 40px rgba(138,43,226,.16)}
    .lead{color:var(--muted);max-width:760px}
    .hero-ctas{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}

    /* Ticker */
    .ticker{position:relative;z-index:1;margin:24px auto 0;max-width:1200px;border-top:1px solid rgba(255,255,255,.06);border-bottom:1px solid rgba(255,255,255,.06);background:linear-gradient(0deg,rgba(255,255,255,.03),rgba(0,0,0,.0));overflow:hidden}
    .marquee{display:flex;gap:30px;padding:10px 0;white-space:nowrap;animation:marq 24s linear infinite}
    .chip{padding:6px 10px;border-radius:10px;font-weight:800;font-size:.9rem;background:#0e1525;border:1px solid rgba(255,255,255,.06);color:var(--muted)}
    .chip.up{color:var(--up);border-color:#20e3b233}.chip.down{color:var(--down);border-color:#ff6b8833}
    @keyframes marq{from{transform:translateX(0)}to{transform:translateX(-50%)}}

    /* Sections */
    section{position:relative;z-index:1;padding:60px 18px}
    .container{max-width:1200px;margin:0 auto;text-align:center}
    .section-title{font-family:Poppins,sans-serif;font-weight:900;font-size:clamp(1.4rem,3vw,2.2rem);margin-bottom:10px}
    .muted{color:var(--muted)}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(3,1fr);justify-items:center}
    @media (max-width: 900px){ .grid{grid-template-columns:1fr} }
    .card{background:linear-gradient(180deg,#0f1726,#0b1422);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:18px;box-shadow:var(--shadow);max-width:100%}
    .card .icon{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;margin:0 auto 10px;background:linear-gradient(135deg,var(--accent2),var(--accent1));box-shadow:inset 0 0 0 2px rgba(255,255,255,.08),0 10px 26px rgba(45,226,230,.22)}
    ul.checks{list-style:none;padding:0;margin:10px 0 0}
    ul.checks li{margin:8px 0}
    .check{display:inline-flex;align-items:center;gap:8px;font-weight:700;color:#d9f1ff}
    .check i{width:20px;height:20px;border-radius:6px;display:inline-grid;place-items:center;background:linear-gradient(135deg,var(--accent4),var(--accent1));color:#0b0f1a;font-size:14px;font-weight:900}

    /* Demo modal (phone) */
    .demo-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(5,7,18,.76);backdrop-filter:blur(10px);z-index:60;padding:18px}
    .demo-modal.active{display:flex}

    .phone{
      width:min(430px,94vw);
      height:min(780px, calc(var(--vh) * 92));
      border-radius:28px;overflow:hidden;
      background:linear-gradient(180deg,#111b33,#0b1426);
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 40px 120px rgba(0,0,0,.55),0 0 0 8px rgba(255,255,255,.04) inset;
      position:relative;display:flex;flex-direction:column;
    }
    .notch{position:absolute;top:10px;left:50%;transform:translateX(-50%);width:42%;height:26px;background:#0a0f24;border-radius:14px;box-shadow:inset 0 1px 0 rgba(255,255,255,.08)}
    .demo-head{padding:48px 12px 10px;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,rgba(138,43,226,.18),transparent 60%);border-bottom:1px solid rgba(255,255,255,.06)}
    .demo-title{font-weight:800;letter-spacing:.2px}
    .demo-close{background:transparent;border:none;color:var(--muted);font-weight:800;cursor:pointer}
    .demo-body{
      padding:10px;display:grid;gap:10px;
      grid-template-rows:auto auto 1fr auto auto auto;
      min-height:0;overflow:auto;
    }
    .asset-card{
      display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;
      background:#121f3d;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:12px
    }
    .asset-name{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .asset-price{font-weight:900;font-size:1.1rem;color:var(--up); text-align:right; font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1, "lnum" 1;}
    .badge{display:inline-block;margin-left:6px;padding:2px 8px;border-radius:999px;background:rgba(45,226,230,.16);color:#bfeff3;font-size:.75rem;font-weight:800;border:1px solid rgba(45,226,230,.35)}
    .hidden{display:none !important;}

    .statbar{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:420px){ .statbar{grid-template-columns:1fr} }
    .stat{background:#121f3d;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px;font-size:.92rem}
    .stat .row{display:flex;justify-content:space-between;align-items:baseline}
    .stat .row strong{font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1, "lnum" 1;}

    .chartWrap{display:grid;gap:8px;min-height:0}
    .chartCard{background:#0e1b38;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:8px;min-height:0}
    #priceCanvas,#rsiCanvas{width:100%;display:block}
    #priceCanvas{height:clamp(160px, 34vh, 260px)}
    #rsiCanvas{height:clamp(90px, 18vh, 130px)}
    .legend{display:flex;gap:12px;flex-wrap:wrap;align-items:center;font-size:.85rem;color:var(--muted)}
    @media (max-height:650px){ .legend{display:none} }

    .coach{
      display:grid;gap:6px;background:#0c1a34;border:1px solid rgba(255,255,255,.18);
      border-radius:14px;padding:10px;color:#e9f7ff;box-shadow:var(--shadow)
    }
    .coach-title{font-size:.8rem;font-weight:900;letter-spacing:.5px;color:#9fd0ff;text-transform:uppercase}
    .coach-msg{font-size:.95rem;line-height:1.35}

    .qty{display:grid;grid-template-columns:1fr auto;gap:8px;background:#121f3d;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:8px;align-items:center}
    .qty input{width:100%;background:transparent;border:none;color:#fff;font-weight:900;font-size:1.1rem;outline:none}

    .trade-controls{position:relative;display:grid;grid-template-columns:1fr 1fr;gap:8px;align-items:center}
    .action-wrap{position:relative}
    .btn-buy{background:linear-gradient(90deg,var(--up),var(--accent4));color:#07121f}
    .btn-sell{background:linear-gradient(90deg,#ff8aa6,var(--accent3));color:#07121f}
    .btn-disabled{opacity:.65;pointer-events:none}
    .pnl{font-weight:900}

    .next-wrap{grid-column:1 / -1;position:relative}
    .next-btn{width:100%;padding:12px;border-radius:14px;border:2px solid rgba(255,255,255,.12);background:linear-gradient(90deg,var(--accent5),var(--accent3));color:#07121f;font-weight:900;letter-spacing:.3px;cursor:pointer;animation:pop 1.1s infinite ease-in-out;box-shadow:0 12px 26px rgba(255,77,141,.25)}
    .next-btn.hidden{display:none}
    @keyframes pop{0%{transform:translateY(0) scale(1)}50%{transform:translateY(-1px) scale(1.03)}100%{transform:translateY(0) scale(1)}}
    .suggested{animation:pop 1.1s ease-in-out infinite}

    .hint{
      position:absolute;bottom:calc(100% + 10px);left:50%;transform:translateX(-50%);
      background:rgba(12,26,52,.98);color:#e9f7ff;border:2px solid rgba(45,226,230,.5);
      border-radius:12px;padding:6px 10px;font-size:.85rem;white-space:nowrap;box-shadow:var(--shadow);
      display:none;z-index:5;pointer-events:none
    }
    .hint::after{content:"";position:absolute;top:100%;left:50%;transform:translateX(-50%);border:8px solid transparent;border-top-color:rgba(45,226,230,.5)}
    .hint.show{display:block}

    .level-complete{position:absolute;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;background:rgba(6,10,28,.7);backdrop-filter:blur(8px);text-align:center;padding:20px;z-index:6}
    .level-complete.active{display:flex}
    .stars{display:flex;gap:14px;margin-bottom:10px}
    .star{width:48px;height:48px;background:radial-gradient(circle at 30% 30%,#fff,#ffe600 60%,#ff8a00);clip-path:polygon(50% 0%, 61% 35%, 98% 35%, 67% 57%, 79% 91%, 50% 70%, 21% 91%, 33% 57%, 2% 35%, 39% 35%);filter:drop-shadow(0 10px 22px rgba(255,204,0,.45));animation:twinkle 1.2s ease-in-out infinite}
    .star:nth-child(2){animation-delay:.15s;transform:scale(1.05)}.star:nth-child(3){animation-delay:.3s;transform:scale(1.1)}
    @keyframes twinkle{0%{transform:translateY(0) scale(1);opacity:.9}50%{transform:translateY(-3px) scale(1.06);opacity:1}100%{transform:translateY(0) scale(1);opacity:.9}}

    .summary{
      width:min(420px, 96%); text-align:left; background:#101c38; border:1px solid rgba(255,255,255,.08);
      border-radius:12px; padding:12px; margin-top:10px; color:var(--text)
    }
    .summary .row{display:flex;justify-content:space-between;margin:6px 0;font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1, "lnum" 1;}
    .summary small{color:var(--muted)}

    /* Modals */
    .waitlist-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(5,7,18,.72);backdrop-filter:blur(8px);z-index:70;padding:18px}
    .waitlist-modal.active{display:flex}
    .waitlist-card{width:min(560px,96vw);background:linear-gradient(180deg,#101a33,#0b1426);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:20px;box-shadow:var(--shadow);text-align:center}
    .waitlist-row{display:grid;grid-template-columns:1fr auto;gap:10px;margin-top:14px}
    .input{width:100%;background:#121f3d;border:1px solid rgba(255,255,255,.1);color:#fff;border-radius:12px;padding:12px;outline:none;font-weight:800}
    .btn-big{padding:14px 18px;border-radius:14px;font-weight:900}
    .close-x{background:transparent;border:none;color:var(--muted);font-weight:900;cursor:pointer;float:right}

    /* OTP modal */
    .otp-card{width:min(520px,96vw);background:linear-gradient(180deg,#101a33,#0b1426);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:18px;box-shadow:var(--shadow);text-align:center}
    .otp-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;margin-top:10px}
    .otp-input{letter-spacing:.3em;text-align:center;font-weight:900;font-size:1.2rem}

    /* Success modal */
    .success-card{width:min(560px,96vw);background:linear-gradient(180deg,#0f1726,#0b1422);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:22px;box-shadow:var(--shadow);text-align:center}
    .success-badge{display:inline-block;background:linear-gradient(90deg,var(--accent4),var(--accent1));color:#07121f;border-radius:999px;padding:6px 10px;font-weight:900;margin-bottom:8px}

    /* Sticky CTA */
    .sticky-cta{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;z-index:50;display:grid;gap:8px;width:min(560px,92vw);background:linear-gradient(180deg,#101a33,#0b1426);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:12px;box-shadow:var(--shadow);animation:slideUp .5s ease-out}
    .sticky-cta.hidden{display:none}
    .sticky-top{display:flex;align-items:center;justify-content:space-between}
    .sticky-left{display:flex;align-items:center;gap:10px}
    .sticky-close{background:transparent;border:2px solid rgba(255,255,255,.18);color:var(--muted);border-radius:10px;padding:4px 8px;font-weight:900;cursor:pointer}
    @keyframes slideUp{from{transform:translate(-50%,20px);opacity:0}to{transform:translate(-50%,0);opacity:1}}

    /* Reveal */
    .reveal{opacity:0;transform:translateY(20px)}
    .reveal.visible{opacity:1;transform:translateY(0);transition:opacity .6s ease, transform .6s ease}

    footer{padding:40px 18px;text-align:center;color:var(--muted);border-top:1px solid rgba(255,255,255,.06)}
  </style>
</head>
<body>
  <div class="bg-candles" aria-hidden="true" id="bgCandles"></div>

  <header>
    <nav class="nav">
      <a class="brand" href="#" aria-label="FracShr home">
        <div class="logo" aria-hidden="true">
          <div class="halo"></div>
          <svg width="34" height="34" viewBox="0 0 110 110" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <linearGradient id="gStroke" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#2DE2E6"/><stop offset=".5" stop-color="#8A2BE2"/><stop offset="1" stop-color="#FF4D8D"/>
              </linearGradient>
              <linearGradient id="gFill" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0" stop-color="#2DE2E6"/><stop offset="1" stop-color="#8A2BE2"/>
              </linearGradient>
            </defs>
            <path d="M55 6 L96 30 L96 80 L55 104 L14 80 L14 30 Z" fill="none" stroke="url(#gStroke)" stroke-width="6" stroke-linejoin="round"/>
            <path d="M34 34 H68 M34 54 H58 M34 34 V78" stroke="url(#gStroke)" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M72 38 C60 30, 48 38, 48 46 C48 54, 76 54, 76 64 C76 74, 60 78, 48 70" fill="none" stroke="url(#gStroke)" stroke-width="6" stroke-linecap="round"/>
            <rect x="50" y="24" width="6" height="16" rx="3" fill="url(#gFill)"/>
            <rect x="50" y="72" width="6" height="14" rx="3" fill="url(#gFill)"/>
          </svg>
        </div>
        <div class="wordmark">FracShr</div>
      </a>

      <button class="menu-btn" id="menuBtn" aria-expanded="false" aria-controls="navLinks" aria-label="Open menu">☰</button>
      <div class="nav-links" id="navLinks">
        <a href="#features">Features</a>
        <a href="#levels">150+ Levels</a>
        <a href="#war">Trading War</a>
        <a href="#challenges">Challenges</a>
        <button class="btn btn-outline" id="playDemoTop">Play Demo</button>
        <button class="btn cta-pulse" id="openWaitlistTop">Register Interest</button>
      </div>
    </nav>
  </header>

  <main>
    <section class="hero">
      <span class="tagline">TRADING FOR EVERYONE, ANYWHERE, EVERYWHERE</span>
      <h1 class="big">Learn. Play. Profit. A Compact Trading Game with Pro Tools.</h1>
      <p class="lead">Guided tutorials, pro-grade charts (Candles + SMA + RSI), goal-based levels, and timed Trading Wars. Designed for clarity and built mobile-first.</p>
      <div class="hero-ctas">
        <button class="btn cta-pulse" id="playDemoHero">Play Guided Demo</button>
        <button class="btn btn-outline" id="openWaitlistHero">Get Early Access (iOS & Android)</button>
      </div>
    </section>

    <div class="ticker" aria-label="sample market ticker">
      <div class="marquee">
        <span class="chip up">FRA +1.1%</span><span class="chip up">AAPL +1.3%</span><span class="chip down">TSLA -0.8%</span>
        <span class="chip up">BTC +2.4%</span><span class="chip up">ETH +1.9%</span><span class="chip up">NVDA +2.2%</span>
        <span class="chip down">AMZN -0.3%</span><span class="chip up">MSFT +1.0%</span>
        <span class="chip up">FRA +1.1%</span><span class="chip up">AAPL +1.3%</span><span class="chip down">TSLA -0.8%</span>
        <span class="chip up">BTC +2.4%</span><span class="chip up">ETH +1.9%</span><span class="chip up">NVDA +2.2%</span>
        <span class="chip down">AMZN -0.3%</span><span class="chip up">MSFT +1.0%</span>
      </div>
    </div>

    <section id="features" class="reveal">
      <div class="container">
        <h2 class="section-title">Everything You Need To Learn Trading—By Playing</h2>
        <p class="muted">Turn complex ideas into bite-sized interactive challenges with real-time visual feedback and coaching.</p>

        <div class="grid" style="margin-top:16px;">
          <div class="card">
            <div class="icon"><svg width="22" height="22" viewBox="0 0 24 24"><path fill="#06111a" d="M3 3h18v2H3V3Zm0 8h12v2H3v-2Zm0 8h18v2H3v-2Z"/></svg></div>
            <h3>Guided Tutorials</h3>
            <p class="muted">Step-by-step missions teach orders, risk, indicators, and strategy—no experience required.</p>
          </div>
          <div class="card">
            <div class="icon" style="background:linear-gradient(135deg,var(--accent2),var(--accent1));"><svg width="22" height="22" viewBox="0 0 24 24"><path fill="#06111a" d="M3 13h4V3H3v10Zm7 8h4V3h-4v18Zm7-4h4V3h-4v14Z"/></svg></div>
            <h3>Pro Charts</h3>
            <p class="muted">Candles with SMA overlays and RSI oscillator. Learn price action with clean, responsive visuals.</p>
          </div>
          <div class="card">
            <div class="icon" style="background:linear-gradient(135deg,var(--accent3),var(--accent5));"><svg width="22" height="22" viewBox="0 0 24 24"><path fill="#06111a" d="m3 13 4-4 4 4 4-4 6 6v4H3v-6Z"/></svg></div>
            <h3>Scenario Levels</h3>
            <p class="muted">Goal-based levels with live P/L. Practice entries, exits, and risk in realistic situations.</p>
          </div>
        </div>

        <div class="grid" style="margin-top:16px;">
          <div class="card">
            <div class="icon" style="background:linear-gradient(135deg,var(--accent4),var(--accent1));"><svg width="22" height="22" viewBox="0 0 24 24"><path fill="#06111a" d="M2 6h8v12H2V6Zm12 0h8v7h-8V6Z"/></svg></div>
            <h3>Trading War</h3>
            <p class="muted">Invite friends for timed profit battles. Same market, same time—most profit wins.</p>
          </div>
          <div class="card">
            <div class="icon" style="background:linear-gradient(135deg,var(--accent1),var(--accent2));"><svg width="22" height="22" viewBox="0 0 24 24"><path fill="#06111a" d="M19 3H5a2 2 0 0 0-2 2v8h2V5h14v14h-8v2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2Z"/></svg></div>
            <h3>Design & Broadcast</h3>
            <p class="muted">Create custom challenges and share with the community. Build, broadcast, compete.</p>
          </div>
          <div class="card">
            <div class="icon" style="background:linear-gradient(135deg,var(--accent5),var(--accent3));"><svg width="22" height="22" viewBox="0 0 24 24"><path fill="#06111a" d="M12 2 2 7l10 5 10-5-10-5Zm0 7L2 4v13h20V4l-10 5Z"/></svg></div>
            <h3>Anywhere, Everywhere</h3>
            <p class="muted">150+ levels, snackable and mobile-first. iOS and Android apps launching soon.</p>
          </div>
        </div>

        <div style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
          <button class="btn" id="playDemoCard">Try the Demo</button>
          <button class="btn btn-outline" id="openWaitlistCard">Join Waitlist</button>
        </div>
      </div>
    </section>

    <section id="levels" class="reveal">
      <div class="container">
        <h2 class="section-title">150+ Levels: From First Trade To Advanced Strategy</h2>
        <p class="muted">Progress through worlds: Basics, Charts, Risk, Momentum, Breakouts, Options intro, Macro events, and more. Earn stars, unlock tools, and track your performance.</p>

        <div class="grid" style="margin-top:14px;">
          <div class="card">
            <h3>Learn by Doing</h3>
            <ul class="checks">
              <li class="check"><i>✓</i> Market vs Limit Orders</li>
              <li class="check"><i>✓</i> Support & Resistance</li>
              <li class="check"><i>✓</i> Risk/Reward & Position Sizing</li>
            </ul>
          </div>
          <div class="card">
            <h3>Go Deeper</h3>
            <ul class="checks">
              <li class="check"><i>✓</i> Indicators (SMA, RSI)</li>
              <li class="check"><i>✓</i> Trend & Momentum</li>
              <li class="check"><i>✓</i> News & Event Scenarios</li>
            </ul>
          </div>
          <div class="card">
            <h3>Build & Share</h3>
            <ul class="checks">
              <li class="check"><i>✓</i> Create custom levels</li>
              <li class="check"><i>✓</i> Broadcast to others</li>
              <li class="check"><i>✓</i> Host your own Trading Wars</li>
            </ul>
          </div>
        </div>

        <div style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
          <button class="btn" id="openWaitlistLevels">Get Launch Invite</button>
          <button class="btn btn-outline" id="playDemoLevels">Try the Demo</button>
        </div>
      </div>
    </section>

    <section id="war" class="reveal">
      <div class="container">
        <h2 class="section-title">Trading War: Time-Based Profit Battles</h2>
        <p class="muted">Invite friends or match globally. Everyone starts with the same cash and instruments. After the countdown, trade your way to the top. Most profit wins.</p>
        <div class="card" style="margin-top:16px;max-width:900px;justify-self:center">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div>
              <h3>How it Works</h3>
              <ul class="checks">
                <li class="check"><i>✓</i> Choose timeframe (3–15 mins)</li>
                <li class="check"><i>✓</i> Select instruments</li>
                <li class="check"><i>✓</i> Live leaderboard updates</li>
                <li class="check"><i>✓</i> Instant replay & stats</li>
              </ul>
              <div style="margin-top:12px">
                <button class="btn" id="openWaitlistWar">Challenge Friends (Coming Soon)</button>
              </div>
            </div>
            <div>
              <div class="card" style="background:#121f3d">
                <h4>Sample Leaderboard</h4>
                <div style="margin-top:10px;display:grid;gap:8px">
                  <div style="display:flex;justify-content:space-between"><span>you_vs_world</span><strong style="color:var(--up)">+3.8%</strong></div>
                  <div style="display:flex;justify-content:space-between"><span>chartninja</span><strong style="color:var(--up)">+3.2%</strong></div>
                  <div style="display:flex;justify-content:space-between"><span>dipbuyer</span><strong style="color:var(--down)">-0.9%</strong></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="challenges" class="reveal">
      <div class="container">
        <h2 class="section-title">Design Your Own Challenges</h2>
        <p class="muted">Build scenarios, set goals, choose assets, and broadcast to others. Turn learning into community-driven play.</p>
        <div class="card" style="margin-top:16px;max-width:900px;justify-self:center">
          <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center">
            <button class="btn" id="openWaitlistChallenges">Create & Broadcast (Soon)</button>
            <button class="btn btn-outline" id="playDemoChallenges">Play Demo</button>
          </div>
        </div>
      </div>
    </section>

    <section class="reveal">
      <div class="container" style="max-width:900px">
        <div class="card">
          <h3>Ready to Level Up?</h3>
          <p class="muted">Join the early access list. We’ll notify you when FracShr launches on iOS & Android.</p>
          <div class="waitlist-row" style="justify-content:center">
            <input id="waitlistEmailBottom" class="input" type="email" placeholder="Enter your email" autocomplete="email" />
            <button class="btn btn-big" id="joinWaitlistBottom">Join Waitlist</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div style="margin-bottom:10px"><span style="font-family:Poppins;font-weight:900;letter-spacing:.3px">FracShr</span> — Trading For Everyone, Anywhere, Everywhere</div>
    <div style="font-size:.9rem">© <span id="year"></span> FracShr. All rights reserved.</div>
  </footer>

  <!-- DEMO GAME MODAL -->
  <div class="demo-modal" id="demoModal" aria-hidden="true" role="dialog" aria-label="FracShr Demo Game">
    <div class="phone" role="document">
      <div class="notch" aria-hidden="true"></div>
      <div class="demo-head">
        <div class="demo-title">FracShr — Demo Level 1</div>
        <button class="demo-close" id="demoClose">Close ✕</button>
      </div>
      <div class="demo-body">
        <div class="asset-card">
          <div>
            <div class="asset-name">FRA • FracShr Index</div>
            <div class="muted" style="font-size:.85rem">Goal: Grow $10,000 to $11,000</div>
          </div>
          <div class="asset-price"><span id="priceLabel">$100.00</span><span id="priceNote" class="badge hidden">Locked</span></div>
        </div>

        <div class="statbar">
          <div class="stat">
            <div class="row"><span>Cash</span><strong id="cashLabel">$10,000.00</strong></div>
            <div class="row"><span>Holdings</span><strong id="holdingsLabel">0</strong></div>
          </div>
          <div class="stat">
            <div class="row"><span>Portfolio</span><strong id="portfolioLabel">$10,000.00</strong></div>
            <div class="row"><span>P/L</span><strong class="pnl" id="pnlLabel">$0.00</strong></div>
          </div>
        </div>

        <div class="chartWrap">
          <div class="chartCard">
            <canvas id="priceCanvas" width="700" height="400" aria-label="Price chart with candles and SMA"></canvas>
            <div class="legend">
              <span><span class="dot" style="background:var(--up)"></span> Up Candle</span>
              <span><span class="dot" style="background:var(--down)"></span> Down Candle</span>
              <span><span class="dot" style="background:var(--accent5)"></span> SMA(10)</span>
              <span><span class="dot" style="background:var(--accent1)"></span> SMA(20)</span>
            </div>
          </div>
          <div class="chartCard">
            <canvas id="rsiCanvas" width="700" height="180" aria-label="RSI oscillator"></canvas>
            <div class="legend">
              <span><span class="dot" style="background:var(--accent5)"></span> RSI(14)</span>
              <span class="muted">70 / 30 lines</span>
            </div>
          </div>
        </div>

        <div class="coach" id="coachBox">
          <div class="coach-title">Coach</div>
          <div class="coach-msg" id="coachMsg" aria-live="polite">Welcome! We’ll guide you to a quick win. Tap Next to begin.</div>
        </div>

        <div class="qty">
          <input type="number" id="qtyInput" value="100" min="1" step="1" />
          <div style="display:flex;gap:6px">
            <button class="btn btn-outline" id="resetDemo">Reset</button>
          </div>
        </div>

        <div class="trade-controls">
          <div class="action-wrap">
            <button class="btn btn-buy btn-disabled" id="buyBtn">Buy</button>
            <div class="hint" id="hintBuy">Tap Buy to open</div>
          </div>
          <div class="action-wrap">
            <button class="btn btn-sell btn-disabled" id="sellBtn">Sell</button>
            <div class="hint" id="hintSell">Tap Sell to lock profit</div>
          </div>
          <div class="next-wrap">
            <button class="next-btn suggested" id="nextBtn">Next ▶</button>
            <div class="hint" id="hintNext" style="left:auto; right:12px; transform:none; bottom:calc(100% + 10px)">Tap Next to continue</div>
          </div>
        </div>
      </div>

      <div class="level-complete" id="levelComplete">
        <div class="stars" aria-hidden="true"><div class="star"></div><div class="star"></div><div class="star"></div></div>
        <h3 style="font-family:Poppins;font-weight:900;margin:6px 0">Congratulations — Level Completed!</h3>
        <p class="muted" style="margin:4px 0 10px">You reached $11,000. Here’s your trade summary and impact:</p>

        <div class="summary" id="summaryBox">
          <div class="row"><small>Start Cash</small><strong id="sumStart">$10,000.00</strong></div>
          <div class="row"><small>Final Portfolio</small><strong id="sumFinal">$11,100.00</strong></div>
          <div class="row"><small>Total Profit</small><strong id="sumProfit">+$1,100.00</strong></div>
          <div class="row"><small>ROI</small><strong id="sumROI">+11.00%</strong></div>
          <hr style="border:none;border-top:1px solid rgba(255,255,255,.1);margin:8px 0">
          <div class="row"><small>Entry</small><strong id="sumEntry">100 @ $100.00</strong></div>
          <div class="row"><small>Exit</small><strong id="sumExit">100 @ $111.00</strong></div>
          <div class="row"><small>Bars Held</small><strong id="sumBars">12</strong></div>
          <div class="row"><small>RSI at Entry/Exit</small><strong id="sumRSI">— → —</strong></div>
          <div class="row"><small>Beat Goal By</small><strong id="sumBeat">+$100.00</strong></div>
          <hr style="border:none;border-top:1px solid rgba(255,255,255,.1);margin:8px 0">
          <div class="row"><small>Impact</small><strong id="sumImpact">+ $11 move × 100 shares = +$1,100</strong></div>
        </div>

        <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px">
          <button class="btn" id="openWaitlistFromComplete">Register Interest</button>
          <button class="btn btn-outline" id="closeDemoFromComplete">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- WAITLIST MODAL -->
  <div class="waitlist-modal" id="waitlistModal" role="dialog" aria-label="Register your interest">
    <div class="waitlist-card">
      <button class="close-x" id="closeWaitlist">✕</button>
      <h3 class="section-title" style="margin:0 0 8px">Be First In — iOS & Android Launch</h3>
      <p class="muted">Enter your email and we’ll text you a one-time code to verify.</p>
      <div class="waitlist-row">
        <input id="waitlistEmail" class="input" type="email" placeholder="Enter your email" autocomplete="email" />
        <button class="btn btn-big" id="joinWaitlist">Register Interest</button>
      </div>
      <input type="text" id="hp_field" class="hidden" tabindex="-1" aria-hidden="true" autocomplete="off" />
      <div class="muted" style="margin-top:8px;font-size:.9rem">No spam ever.</div>
    </div>
  </div>

  <!-- OTP MODAL -->
  <div class="waitlist-modal" id="otpModal" role="dialog" aria-label="Verify your email">
    <div class="otp-card">
      <button class="close-x" id="closeOtp">✕</button>
      <h3 class="section-title" style="margin:0 0 8px">Verify your email</h3>
      <p class="muted" style="margin:0 0 10px">We’ve sent a 6‑digit code. Enter it below to confirm your spot.</p>

      <div class="waitlist-row" style="grid-template-columns:1fr auto">
        <input id="otpEmail" class="input" type="email" placeholder="you@example.com" autocomplete="email" />
        <button class="btn" id="sendOtpBtn">Send OTP</button>
      </div>

      <div class="otp-row">
        <input id="otpCode" class="input otp-input" type="text" inputmode="numeric" maxlength="6" placeholder="______" />
        <button class="btn btn-big" id="verifyOtpBtn">Verify</button>
      </div>

      <div class="muted" id="otpStatus" style="margin-top:10px;font-size:.9rem">Enter the code within 5 minutes.</div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:10px">
        <button class="btn btn-outline" id="resendOtpBtn">Resend</button>
        <button class="btn btn-outline" id="cancelOtpBtn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- SUCCESS MODAL -->
  <div class="waitlist-modal" id="successModal" role="dialog" aria-label="Welcome">
    <div class="success-card">
      <div class="success-badge">Verified</div>
      <h3 class="section-title" style="margin:6px 0 4px">Welcome to the Trading Revolution</h3>
      <p class="muted" style="margin:0 0 10px">Congratulations! You’re officially on the FracShr waitlist. We’ll keep you posted on early access and launch updates.</p>
      <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
        <button class="btn" id="successClose">Awesome!</button>
        <button class="btn btn-outline" id="successPlayDemo">Play the Demo</button>
      </div>
    </div>
  </div>

  <!-- Sticky CTA -->
  <div class="sticky-cta hidden" id="stickyCTA" aria-live="polite">
    <div class="sticky-top">
      <div class="sticky-left">
        <div style="width:32px;height:32px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2))"></div>
        <div>
          <strong>Don’t miss the launch</strong>
          <div class="muted" style="font-size:.9rem">Join the waitlist for early access</div>
        </div>
      </div>
      <button class="sticky-close" id="closeStickyCTA">✕</button>
    </div>
    <div class="waitlist-row" style="grid-template-columns:1fr auto">
      <input id="waitlistEmailSticky" class="input" type="email" placeholder="Email address" autocomplete="email" />
      <button class="btn" id="joinWaitlistSticky">Notify Me</button>
    </div>
  </div>

  <!-- EmailJS (for OTP sending) -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js" defer></script>

  <script>
    /* CENTRAL CONFIG (pre-filled so you don’t have to edit anything) */
    const CFG = {
      brand: 'FracShr',
      web3forms: {
        accessKey: '27183595-25e6-4c36-93ba-8c855c7763eb',
        api: 'https://api.web3forms.com/submit'
      },
      otp: {
        required: true,
        expiryMs: 5 * 60 * 1000,
        resendMs: 45 * 1000
      },
      emailjs: {
        publicKey: '6BWuApUnhyOgHXQ5q',
        serviceId: 'service_63pnjrq',
        templateId: 'template_hi01far',
        sendThanks: true,
        thanksDelayMs: 400
      },
      emailBodies: {
        otp: {
          subject: '${brand} verification code: ${otp}',
          text: 'Hello ${email}\\n\\nYour one-time verification code for ${brand} is: ${otp}.\\nThis code expires in ${minutes} minutes. If you didn’t request this, you can safely ignore this email.\\n\\n— ${brand} Team'
        },
        thanks: {
          subject: 'You’re in! Next steps for ${brand}',
          text: 'Hi ${email},\\n\\nThanks for verifying your email and joining the ${brand} waitlist.\\nHere’s what to expect:\\n• Early access invites as we roll out\\n• Feature previews and feedback opportunities\\n• Launch announcement for iOS & Android\\n\\nWe’re excited to have you aboard.\\n\\n— ${brand} Team'
        },
        owner: {
          subject: 'New verified waitlist signup — ${brand}',
          text:
            'New verified signup for ${brand}\\n' +
            'Email: ${email}\\n' +
            'Source: ${source}\\n' +
            'Time: ${ts}\\n' +
            'User Agent: ${ua}\\n' +
            'Referrer: ${ref}'
        }
      }
    };

    /* Utilities */
    function setVH(){ document.documentElement.style.setProperty('--vh', (window.innerHeight * 0.01) + 'px'); }
    setVH(); window.addEventListener('resize', setVH); window.addEventListener('orientationchange', ()=> setTimeout(setVH, 200));
    document.getElementById('year').textContent = new Date().getFullYear();
    function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((v||'').trim()); }
    function templ(str, data){ return String(str).replace(/\$\{(\w+)\}/g, (_,k)=> (data[k]!==undefined && data[k]!==null)? String(data[k]) : ''); }
    const debounce = (fn, ms)=>{ let t; return (...args)=>{ clearTimeout(t); t = setTimeout(()=> fn.apply(this,args), ms); }; };
    function nowIso(){ return new Date().toISOString(); }

    /* Header menu */
    const menuBtn = document.getElementById('menuBtn');
    const navLinks = document.getElementById('navLinks');
    menuBtn?.addEventListener('click', ()=>{
      const open = !navLinks.classList.contains('open');
      navLinks.classList.toggle('open', open);
      menuBtn.setAttribute('aria-expanded', open?'true':'false');
      document.body.classList.toggle('menu-open', open);
    });
    navLinks.addEventListener('click', (e)=>{
      if(e.target.closest('a,button')){
        navLinks.classList.remove('open'); document.body.classList.remove('menu-open'); menuBtn.setAttribute('aria-expanded','false');
      }
    });
    window.addEventListener('resize', ()=>{ if(window.innerWidth>760){ navLinks.classList.remove('open'); document.body.classList.remove('menu-open'); menuBtn.setAttribute('aria-expanded','false'); }});

    /* Background (floating candles) */
    const bgCandles = document.getElementById('bgCandles');
    function spawnCandles(count=30){
      for (let i=0;i<count;i++){
        const d=document.createElement('div');
        d.className='candle';
        d.style.left=(Math.random()*100)+'vw';
        d.style.animationDuration=(8+Math.random()*12)+'s';
        d.style.animationDelay=(Math.random()*6)+'s';
        d.style.opacity=(0.2+Math.random()*0.35).toFixed(2);
        bgCandles.appendChild(d);
      }
    }
    spawnCandles(40);
    setInterval(()=>spawnCandles(3), 3000);

    /* Reveal on scroll */
    const revealEls=document.querySelectorAll('.reveal');
    const io=new IntersectionObserver(entries=>{
      entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('visible'); io.unobserve(e.target); }});
    },{threshold:.12});
    revealEls.forEach(el=>io.observe(el));

    /* Sticky CTA */
    const stickyCTA=document.getElementById('stickyCTA');
    const closeStickyCTA=document.getElementById('closeStickyCTA');
    function showStickyCTA(){ if (localStorage.getItem('fracshr_waitlisted_verified')!=='1') stickyCTA.classList.remove('hidden'); }
    function hideStickyCTA(persist=false){ stickyCTA.classList.add('hidden'); if(persist){ try{ localStorage.setItem('fracshr_hide_sticky','1'); }catch(e){} } }
    closeStickyCTA.addEventListener('click', ()=> hideStickyCTA(true));
    setTimeout(showStickyCTA, 15000);

    /* Modals */
    const waitlistModal=document.getElementById('waitlistModal');
    const otpModal=document.getElementById('otpModal');
    const successModal=document.getElementById('successModal');
    const openWaitlist = ()=> waitlistModal.classList.add('active');
    const closeWaitlist = ()=> waitlistModal.classList.remove('active');
    const openOtp = ()=> otpModal.classList.add('active');
    const closeOtp = ()=> otpModal.classList.remove('active');
    const openSuccess = ()=> successModal.classList.add('active');
    const closeSuccess = ()=> successModal.classList.remove('active');
    document.getElementById('closeWaitlist').addEventListener('click', closeWaitlist);
    document.getElementById('closeOtp').addEventListener('click', closeOtp);
    document.getElementById('cancelOtpBtn').addEventListener('click', closeOtp);
    document.getElementById('successClose').addEventListener('click', ()=> { closeSuccess(); });
    document.getElementById('successPlayDemo').addEventListener('click', ()=> { closeSuccess(); openDemo(); });

    ['openWaitlistTop','openWaitlistHero','openWaitlistCard','openWaitlistLevels','openWaitlistWar','openWaitlistChallenges']
      .forEach(id=> document.getElementById(id)?.addEventListener('click', openWaitlist));

    /* OTP + Web3Forms */
    let OTP_STATE = { email:null, code:null, expires:0, resendAt:0, source:'Unknown', lastSentTo:null };
    const otpEmailEl = document.getElementById('otpEmail');
    const otpCodeEl  = document.getElementById('otpCode');
    const otpStatus  = document.getElementById('otpStatus');
    const sendOtpBtn = document.getElementById('sendOtpBtn');
    const resendOtpBtn = document.getElementById('resendOtpBtn');
    const verifyOtpBtn = document.getElementById('verifyOtpBtn');
    const inputsMap = [
      { id: 'waitlistEmail', source:'Modal' },
      { id: 'waitlistEmailBottom', source:'Bottom CTA' },
      { id: 'waitlistEmailSticky', source:'Sticky CTA' }
    ];

    function ensureEmailJSInit(){
      if (window.emailjs && CFG.emailjs.publicKey) {
        try { emailjs.init(CFG.emailjs.publicKey); } catch(e){}
      }
    }
    window.addEventListener('load', ensureEmailJSInit);

    function beginWaitlist(inputId, source){
      const el = document.getElementById(inputId);
      const email = (el?.value||'').trim();
      const hp = document.getElementById('hp_field')?.value || '';
      if (!validEmail(email)) {
        el?.focus();
        if (el) { el.style.borderColor = '#FF4D8D'; setTimeout(()=> el.style.borderColor='rgba(255,255,255,.1)', 1500); }
        return;
      }
      if (hp) { // honeypot – silently accept
        submitWeb3Forms(email, source);
        return;
      }
      // Auto-open OTP
      closeWaitlist();
      otpEmailEl.value = email;
      OTP_STATE.source = source || 'Waitlist';
      openOtp();
      // Auto-send OTP
      sendOTP(true);
    }

    function generateCode(){ return String(Math.floor(100000 + Math.random()*900000)); }

    async function sendEmailJS(to, subject, message, extraVars={}){
      ensureEmailJSInit();
      return emailjs.send(CFG.emailjs.serviceId, CFG.emailjs.templateId, {
        to_email: to,
        subject,
        message,
        otp: extraVars.otp || '',
        site_name: CFG.brand
      });
    }

    async function sendOTP(auto=false){
      const email = (otpEmailEl.value||'').trim();
      if (!validEmail(email)) {
        otpEmailEl.focus();
        otpEmailEl.style.borderColor = '#FF4D8D';
        setTimeout(()=> otpEmailEl.style.borderColor='rgba(255,255,255,.1)', 1500);
        return;
      }
      if (!window.emailjs) {
        otpStatus.textContent = 'Preparing email service... Please try again.';
        setTimeout(()=> sendOTP(auto), 600);
        return;
      }
      const now = Date.now();
      if (!auto && now < OTP_STATE.resendAt) {
        const secs = Math.ceil((OTP_STATE.resendAt - now)/1000);
        otpStatus.textContent = `Please wait ${secs}s before resending.`;
        return;
      }
      const code = generateCode();
      OTP_STATE.email = email;
      OTP_STATE.code = code;
      OTP_STATE.expires = now + CFG.otp.expiryMs;
      OTP_STATE.resendAt = now + CFG.otp.resendMs;

      otpStatus.textContent = 'Sending code...';
      const minutes = Math.round(CFG.otp.expiryMs/60000);
      const subject = templ(CFG.emailBodies.otp.subject, { brand: CFG.brand, otp: code, email, minutes });
      const text    = templ(CFG.emailBodies.otp.text,    { brand: CFG.brand, otp: code, email, minutes });

      try{
        await sendEmailJS(email, subject, text, { otp: code });
        otpStatus.textContent = `OTP sent to ${email}. Code valid for ${minutes} minutes.`;
      }catch(_e){
        otpStatus.textContent = 'Could not send OTP. Please try again in a moment.';
      }
    }

    async function verifyOTP(){
      const entered = (otpCodeEl.value||'').trim();
      const now = Date.now();
      if (!OTP_STATE.code || now > OTP_STATE.expires) {
        otpStatus.textContent = 'Code expired. Please resend a new OTP.';
        return;
      }
      if (entered !== OTP_STATE.code) {
        otpStatus.textContent = 'Invalid code. Please try again.';
        otpCodeEl.focus();
        return;
      }
      // Verified: submit to Web3Forms
      const email = OTP_STATE.email;
      closeOtp();
      await submitWeb3Forms(email, OTP_STATE.source);
      // Optional thank-you to user
      if (CFG.emailjs.sendThanks && window.emailjs) {
        setTimeout(async ()=>{
          const subject = templ(CFG.emailBodies.thanks.subject, { brand: CFG.brand, email });
          const text    = templ(CFG.emailBodies.thanks.text,    { brand: CFG.brand, email });
          try{ await sendEmailJS(email, subject, text); }catch(_e){}
        }, CFG.emailjs.thanksDelayMs);
      }
      // Show success modal
      openSuccess();
      localStorage.setItem('fracshr_waitlisted_verified', '1');
      hideStickyCTA(true);
    }

    async function submitWeb3Forms(email, source){
      const dataCtx = {
        brand: CFG.brand,
        email,
        source: source || 'Unknown',
        ts: nowIso(),
        ua: navigator.userAgent,
        ref: document.referrer
      };
      const subject = templ(CFG.emailBodies.owner.subject, dataCtx);
      const message = templ(CFG.emailBodies.owner.text, dataCtx);

      const payload = {
        access_key: CFG.web3forms.accessKey,
        subject,
        from_name: `${CFG.brand} Site`,
        email,
        message,
        page_url: location.href,
        referrer: dataCtx.ref,
        user_agent: dataCtx.ua
      };
      try{
        await fetch(CFG.web3forms.api, {
          method: 'POST',
          headers: { 'Content-Type':'application/json', 'Accept':'application/json' },
          body: JSON.stringify(payload),
          cache: 'no-store',
          redirect: 'follow'
        });
      }catch(_e){ /* ignore; UI already shows success */ }
    }

    sendOtpBtn.addEventListener('click', ()=> sendOTP(false));
    resendOtpBtn.addEventListener('click', ()=> sendOTP(false));
    verifyOtpBtn.addEventListener('click', verifyOTP);
    otpCodeEl.addEventListener('keydown', (e)=> { if(e.key==='Enter'){ verifyOTP(); } });

    // Openers / Inputs
    document.getElementById('joinWaitlist').addEventListener('click', ()=> beginWaitlist('waitlistEmail','Modal'));
    document.getElementById('joinWaitlistBottom').addEventListener('click', ()=> beginWaitlist('waitlistEmailBottom','Bottom CTA'));
    document.getElementById('joinWaitlistSticky').addEventListener('click', ()=> beginWaitlist('waitlistEmailSticky','Sticky CTA'));
    document.getElementById('successClose').addEventListener('click', ()=> { closeSuccess(); });

    // Auto-start OTP “as soon as user enters email”
    const autoStartedSet = new Set();
    function autoStartFromField(id, source){
      const el = document.getElementById(id);
      if (!el) return;
      const handler = debounce(()=> {
        const email = (el.value||'').trim();
        if (validEmail(email) && !autoStartedSet.has(email)) {
          autoStartedSet.add(email);
          closeWaitlist();
          otpEmailEl.value = email;
          OTP_STATE.source = source;
          openOtp();
          sendOTP(true);
        }
      }, 700);
      el.addEventListener('input', handler);
      el.addEventListener('change', handler);
      el.addEventListener('keydown', (e)=> { if(e.key==='Enter'){ handler(); } });
      el.addEventListener('blur', handler);
    }
    inputsMap.forEach(({id,source})=> autoStartFromField(id, source));

    // Close modals by backdrop click
    waitlistModal.addEventListener('click', (e)=> { if(e.target===waitlistModal) closeWaitlist(); });
    otpModal.addEventListener('click', (e)=> { if(e.target===otpModal) closeOtp(); });
    successModal.addEventListener('click', (e)=> { if(e.target===successModal) closeSuccess(); });

    // Keyboard escape
    window.addEventListener('keydown', (e)=> {
      if(e.key==='Escape'){
        if(waitlistModal.classList.contains('active')) closeWaitlist();
        else if(otpModal.classList.contains('active')) closeOtp();
        else if(successModal.classList.contains('active')) closeSuccess();
        else if(demoModal.classList.contains('active')) closeDemo();
      }
    });

    /* DEMO GAME (compact, as earlier) */
    const demoModal=document.getElementById('demoModal');
    const playDemoButtons=['playDemoTop','playDemoHero','playDemoCard','playDemoLevels','playDemoChallenges']
      .map(id=>document.getElementById(id)).filter(Boolean);
    playDemoButtons.forEach(btn=> btn.addEventListener('click', openDemo));
    document.getElementById('demoClose').addEventListener('click', closeDemo);
    document.getElementById('openWaitlistFromComplete').addEventListener('click', openWaitlist);
    document.getElementById('closeDemoFromComplete').addEventListener('click', closeDemo);

    const priceLabel=document.getElementById('priceLabel');
    const priceNote=document.getElementById('priceNote');
    const cashLabel=document.getElementById('cashLabel');
    const holdingsLabel=document.getElementById('holdingsLabel');
    const portfolioLabel=document.getElementById('portfolioLabel');
    const pnlLabel=document.getElementById('pnlLabel');
    const buyBtn=document.getElementById('buyBtn');
    const sellBtn=document.getElementById('sellBtn');
    const nextBtn=document.getElementById('nextBtn');
    const qtyInput=document.getElementById('qtyInput');
    const resetDemoBtn=document.getElementById('resetDemo');
    const levelComplete=document.getElementById('levelComplete');
    const coachMsg=document.getElementById('coachMsg');
    const hintBuy = document.getElementById('hintBuy');
    const hintSell = document.getElementById('hintSell');
    const hintNext = document.getElementById('hintNext');

    let demoState=null;
    let guideTimer=null;
    let actions=[];
    const priceCanvas=document.getElementById('priceCanvas');
    const rsiCanvas=document.getElementById('rsiCanvas');
    let pctx, rctx, dpr, ro;
    let bars=[]; const MAX_BARS=80;

    function openDemo(){ demoModal.classList.add('active'); initDemo(); }
    function closeDemo(){ demoModal.classList.remove('active'); if(guideTimer){ clearInterval(guideTimer); guideTimer=null; } clearHints(); }
    resetDemoBtn.addEventListener('click', initDemo);

    function initDemo(){
      if(guideTimer){ clearInterval(guideTimer); guideTimer=null; }
      levelComplete.classList.remove('active');
      actions=[];

      demoState={
        step:0,
        marketPrice:100.00,
        useLockedPrice:false,
        lockedPrice:null,
        cash:10000.00,
        holdings:0,
        avgPrice:0,
        realizedPnL:0,
        goal:11000.00,
        startCash:10000.00,
        buyIndex:null,
        sellIndex:null
      };
      qtyInput.value=100; qtyInput.disabled=true;
      buyBtn.classList.add('btn-disabled'); sellBtn.classList.add('btn-disabled');
      nextBtn.classList.remove('hidden'); nextBtn.textContent='Next ▶'; nextBtn.classList.add('suggested');
      showCoach("Welcome! I’m your coach. Tap Next and I’ll walk you through a winning trade.");
      clearHints(); hintNext.classList.add('show');

      setupCanvases();
      generateInitialBars();
      drawAll();
      updateUI();
    }

    function setupCanvases(){
      dpr=window.devicePixelRatio||1;
      if(!ro){
        ro = new ResizeObserver(()=>{
          const rectP=priceCanvas.getBoundingClientRect();
          const rectR=rsiCanvas.getBoundingClientRect();
          priceCanvas.width = Math.round(Math.max(100, rectP.width) * dpr);
          priceCanvas.height = Math.round(Math.max(80, rectP.height) * dpr);
          rsiCanvas.width = Math.round(Math.max(100, rectR.width) * dpr);
          rsiCanvas.height = Math.round(Math.max(60, rectR.height) * dpr);
          pctx.setTransform(dpr,0,0,dpr,0,0);
          rctx.setTransform(dpr,0,0,dpr,0,0);
          drawAll();
        });
      }
      pctx=priceCanvas.getContext('2d'); rctx=rsiCanvas.getContext('2d');
      const rectP=priceCanvas.getBoundingClientRect();
      const rectR=rsiCanvas.getBoundingClientRect();
      priceCanvas.width = Math.round(Math.max(100, rectP.width) * dpr);
      priceCanvas.height = Math.round(Math.max(80, rectP.height) * dpr);
      rsiCanvas.width = Math.round(Math.max(100, rectR.width) * dpr);
      rsiCanvas.height = Math.round(Math.max(60, rectR.height) * dpr);
      pctx.setTransform(dpr,0,0,dpr,0,0);
      rctx.setTransform(dpr,0,0,dpr,0,0);
      ro.observe(priceCanvas.parentElement);
      ro.observe(rsiCanvas.parentElement);
    }

    function generateInitialBars(){
      bars=[];
      let last=100;
      for(let i=0;i<30;i++){
        const o=last;
        const delta=(Math.random()-.5)*0.5;
        const c=o+delta;
        const h=Math.max(o,c)+Math.random()*0.3;
        const l=Math.min(o,c)-Math.random()*0.3;
        bars.push({o,h,l,c});
        last=c;
      }
      demoState.marketPrice = bars[bars.length-1].c;
    }

    function SMA(closes, period){
      const out=new Array(closes.length).fill(null);
      let sum=0;
      for(let i=0;i<closes.length;i++){
        sum+=closes[i];
        if(i>=period) sum-=closes[i-period];
        if(i>=period-1) out[i]=sum/period;
      }
      return out;
    }
    function RSI(closes, period=14){
      const out=new Array(closes.length).fill(null);
      if (closes.length < period+1) return out;
      let gains=0, losses=0;
      for(let i=1;i<=period;i++){
        const diff=closes[i]-closes[i-1];
        if(diff>=0) gains+=diff; else losses+=-diff;
      }
      let avgGain=gains/period, avgLoss=losses/period;
      out[period]= 100 - (100/(1 + (avgGain/(avgLoss||1e-6))));
      for(let i=period+1;i<closes.length;i++){
        const diff=closes[i]-closes[i-1];
        const gain= diff>0?diff:0;
        const loss= diff<0?-diff:0;
        avgGain = (avgGain*(period-1) + gain)/period;
        avgLoss = (avgLoss*(period-1) + loss)/period;
        const rs = avgGain/(avgLoss||1e-6);
        out[i]= 100 - (100/(1+rs));
      }
      return out;
    }
    function getCloses(){ return bars.map(b=>b.c); }

    function drawAll(){ drawPriceChart(); drawRSIChart(); }
    function drawPriceChart(){
      const ctx=pctx; const w=priceCanvas.clientWidth; const h=priceCanvas.clientHeight;
      ctx.clearRect(0,0,w,h);
      ctx.strokeStyle='rgba(255,255,255,.06)'; ctx.lineWidth=1;
      for(let i=0;i<=5;i++){ ctx.beginPath(); ctx.moveTo(0,i*(h/5)); ctx.lineTo(w,i*(h/5)); ctx.stroke(); }

      const PADDING=10;
      const visible=bars.slice(-50);
      const highs=visible.map(b=>b.h), lows=visible.map(b=>b.l);
      const min=Math.min(...lows); const max=Math.max(...highs); const range=(max-min)||1;
      const cw=w - PADDING*2; const ch=h - PADDING*2; const bw = Math.max(2, cw/visible.length - 2);
      const closes=visible.map(b=>b.c);
      const sma10=SMA(closes,10), sma20=SMA(closes,20);
      function yFor(v){ return h - PADDING - ((v - min)/range)*ch; }

      visible.forEach((b, i)=>{
        const x = PADDING + i*(cw/visible.length) + 1;
        ctx.strokeStyle='rgba(255,255,255,.35)';
        ctx.beginPath(); ctx.moveTo(x+bw/2, yFor(b.h)); ctx.lineTo(x+bw/2, yFor(b.l)); ctx.stroke();
        const up=b.c>=b.o; ctx.fillStyle = up ? getComputedStyle(document.documentElement).getPropertyValue('--up').trim() : getComputedStyle(document.documentElement).getPropertyValue('--down').trim();
        const top = yFor(up?b.c:b.o); const bottom = yFor(up?b.o:b.c);
        const height=Math.max(1, bottom - top);
        ctx.fillRect(x, top, bw, height);
      });

      ctx.lineWidth=2; ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent5').trim(); ctx.beginPath();
      sma10.forEach((v,i)=>{ if(v==null) return; const x=PADDING + i*(cw/sma10.length) + bw/2; const y=yFor(v); if(i===0||sma10[i-1]==null) ctx.moveTo(x,y); else ctx.lineTo(x,y);}); ctx.stroke();
      ctx.lineWidth=2; ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent1').trim(); ctx.beginPath();
      sma20.forEach((v,i)=>{ if(v==null) return; const x=PADDING + i*(cw/sma20.length) + bw/2; const y=yFor(v); if(i===0||sma20[i-1]==null) ctx.moveTo(x,y); else ctx.lineTo(x,y);}); ctx.stroke();
    }
    function drawRSIChart(){
      const ctx=rctx; const w=rsiCanvas.clientWidth; const h=rsiCanvas.clientHeight;
      ctx.clearRect(0,0,w,h);
      ctx.strokeStyle='rgba(255,255,255,.06)'; ctx.lineWidth=1;
      for(let i=0;i<=4;i++){ ctx.beginPath(); ctx.moveTo(0,i*(h/4)); ctx.lineTo(w,i*(h/4)); ctx.stroke(); }
      const closes=getCloses().slice(-50); const rsiArr=RSI(closes,14);
      function yForRSI(v){ return h - (v/100)*h; }
      ctx.fillStyle='rgba(255,77,141,.08)'; ctx.fillRect(0, 0, w, yForRSI(70));
      ctx.fillStyle='rgba(32,227,178,.08)'; ctx.fillRect(0, yForRSI(30), w, h - yForRSI(30));
      ctx.strokeStyle='rgba(255,255,255,.25)'; [70,50,30].forEach(v=>{ ctx.beginPath(); ctx.moveTo(0, yForRSI(v)); ctx.lineTo(w, yForRSI(v)); ctx.stroke(); });
      ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent5').trim(); ctx.lineWidth=2; ctx.beginPath();
      rsiArr.forEach((v,i)=>{ if(v==null) return; const x = (i/(rsiArr.length-1)) * (w-10) + 5; const y = yForRSI(v); if(i===0||rsiArr[i-1]==null) ctx.moveTo(x,y); else ctx.lineTo(x,y);}); ctx.stroke();
    }

    function addBar(nextClose){
      const last=bars[bars.length-1]||{c:100};
      const o=last.c; const c=Number(nextClose.toFixed(2));
      const h=Math.max(o,c)+Math.random()*0.25; const l=Math.min(o,c)-Math.random()*0.25;
      bars.push({o,h,l,c}); if(bars.length>MAX_BARS) bars.shift();
      demoState.marketPrice=c;
    }

    function idleWobble(){
      if(guideTimer) return;
      const last=bars[bars.length-1]?.c||100;
      const next= last + (Math.random()-.5)*0.25;
      addBar(next); drawAll(); updateUI();
    }
    setInterval(idleWobble, 1200);

    function getUsedPrice(){ return demoState.useLockedPrice ? demoState.lockedPrice : demoState.marketPrice; }
    function updateUI(){
      const usedPrice = getUsedPrice();
      priceLabel.textContent = '$' + usedPrice.toFixed(2);
      priceNote.classList.toggle('hidden', !demoState.useLockedPrice);
      cashLabel.textContent = '$' + demoState.cash.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      holdingsLabel.textContent = String(demoState.holdings);
      const portfolio = demoState.cash + demoState.holdings * usedPrice;
      portfolioLabel.textContent = '$' + portfolio.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      const unreal = demoState.holdings>0 ? (usedPrice - demoState.avgPrice)*demoState.holdings : 0;
      const totalPNL = demoState.realizedPnL + unreal;
      pnlLabel.textContent = (totalPNL>=0?'+':'-') + '$' + Math.abs(totalPNL).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      pnlLabel.style.color = totalPNL>=0 ? 'var(--up)' : 'var(--down)';
    }
    function showCoach(t){ coachMsg.textContent=t; }
    function clearHints(){ [hintBuy, hintSell, hintNext].forEach(h=> h.classList.remove('show')); [buyBtn,sellBtn,nextBtn].forEach(b=> b.classList.remove('suggested')); }

    nextBtn.addEventListener('click', ()=>{
      switch(demoState.step){
        case 0:
          demoState.step=1;
          qtyInput.disabled=false; qtyInput.value=100;
          buyBtn.classList.remove('btn-disabled'); buyBtn.classList.add('suggested');
          showCoach("Step 1: Set quantity to 100 and tap BUY to open a position.");
          nextBtn.classList.add('hidden');
          clearHints(); hintBuy.classList.add('show');
          break;
        case 2:
          demoState.step=3;
          demoState.useLockedPrice = false;
          showCoach("Step 2: Watch the price move to your target. I’ll do the lifting—just observe.");
          nextBtn.classList.add('hidden');
          clearHints(); startGuidedRise();
          break;
        case 4:
          demoState.step=5;
          sellBtn.classList.remove('btn-disabled'); sellBtn.classList.add('suggested');
          showCoach("Step 3: Tap SELL to lock in your profit and finish the level.");
          nextBtn.classList.add('hidden');
          clearHints(); hintSell.classList.add('show');
          break;
      }
    });

    buyBtn.addEventListener('click', ()=>{
      if(buyBtn.classList.contains('btn-disabled')) return;
      let qty=Math.max(1, Math.floor(Number(qtyInput.value)||0));
      if(qty !== 100){
        qtyInput.value = 100;
        showCoach("For this demo, buy 100 shares. I’ve set it for you—tap BUY again.");
        return;
      }
      const buyPrice = 100.00;
      const cost=qty * buyPrice;
      if(cost>demoState.cash){ showCoach("Not enough cash. Reduce quantity or reset."); return; }
      demoState.cash-=cost; demoState.holdings+=qty; demoState.avgPrice=buyPrice;
      demoState.useLockedPrice = true; demoState.lockedPrice = 100.00;

      updateUI(); drawAll();
      buyBtn.classList.add('btn-disabled'); buyBtn.classList.remove('suggested'); qtyInput.disabled=true;
      demoState.step=2;
      showCoach("Great entry. Price is locked for clarity while the chart animates. Tap Next to continue.");
      nextBtn.classList.remove('hidden'); nextBtn.classList.add('suggested');
      clearHints(); hintNext.classList.add('show');
    });

    function startGuidedRise(){
      const target=111.00;
      const steps=12; const interval=950;
      let tick=0;
      guideTimer=setInterval(()=>{
        tick++;
        const last=bars[bars.length-1]?.c || 100;
        const remaining=target - last;
        const move = remaining/Math.max(1, (steps - tick + 1)) + (Math.random()*0.04);
        const next= last + Math.max(0.06, move);
        addBar(next);
        drawAll(); updateUI();
        if(tick>=steps || demoState.marketPrice>=target){
          clearInterval(guideTimer); guideTimer=null;
          demoState.step=4;
          showCoach("Nice! You’re in profit. Tap Next for the final step.");
          nextBtn.classList.remove('hidden'); nextBtn.classList.add('suggested');
          clearHints(); hintNext.classList.add('show');
        }
      }, interval);
    }

    sellBtn.addEventListener('click', ()=>{
      if(sellBtn.classList.contains('btn-disabled')) return;
      if(demoState.holdings<=0) return;

      const sellPrice = demoState.marketPrice;
      const revenue = demoState.holdings * sellPrice;
      const costBasis = demoState.holdings * demoState.avgPrice;
      const pl = revenue - costBasis;
      demoState.cash += revenue;
      demoState.realizedPnL += pl;

      demoState.holdings = 0;
      updateUI();

      const portfolio = demoState.cash;
      if(portfolio >= demoState.goal){
        setTimeout(()=> { fillSummary(); levelComplete.classList.add('active'); }, 500);
      }else{
        showCoach("Almost there! Try another trade or reset the demo.");
      }
      sellBtn.classList.add('btn-disabled'); sellBtn.classList.remove('suggested');
      clearHints();
    });

    function fillSummary(){
      const start = demoState.startCash;
      const final = demoState.cash + demoState.holdings*getUsedPrice();
      const profit = final - start;
      const roi = (profit / start) * 100;

      const barsHeld = (demoState.sellIndex!=null && demoState.buyIndex!=null) ? (demoState.sellIndex - demoState.buyIndex) : 0;
      const beat = final - demoState.goal;

      document.getElementById('sumStart').textContent = '$' + start.toFixed(2);
      document.getElementById('sumFinal').textContent = '$' + final.toFixed(2);
      document.getElementById('sumProfit').textContent = (profit>=0?'+':'-') + '$' + Math.abs(profit).toFixed(2);
      document.getElementById('sumROI').textContent = (roi>=0?'+':'') + roi.toFixed(2) + '%';
      document.getElementById('sumEntry').textContent = `100 @ $100.00`;
      document.getElementById('sumExit').textContent = `100 @ $111.00`;
      document.getElementById('sumBars').textContent = String(Math.max(0, barsHeld));
      document.getElementById('sumRSI').textContent = '— → —';
      document.getElementById('sumBeat').textContent = (beat>=0?'+':'-') + '$' + Math.abs(beat).toFixed(2);
      document.getElementById('sumImpact').textContent = `+ $11.00 move × 100 shares = +$1,100.00`;
    }

    // Demo openers (safety)
    ['playDemoTop','playDemoHero','playDemoCard','playDemoLevels','playDemoChallenges']
      .forEach(id=> document.getElementById(id)?.addEventListener('click', openDemo));

    document.getElementById('openWaitlistCard')?.addEventListener('click', openWaitlist);
    document.getElementById('openWaitlistLevels')?.addEventListener('click', openWaitlist);
    document.getElementById('openWaitlistWar')?.addEventListener('click', openWaitlist);
    document.getElementById('openWaitlistChallenges')?.addEventListener('click', openWaitlist);
  </script>
</body>
</html>
